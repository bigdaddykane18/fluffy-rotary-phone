<!doctype html>
<html 
      lang="en"
      dir="ltr">
  <head>
    <meta name="google-signin-client-id" content="157101835696-ooapojlodmuabs2do2vuhhnf90bccmoi.apps.googleusercontent.com">
    <meta name="google-signin-scope"
          content="profile email https://www.googleapis.com/auth/developerprofiles https://www.googleapis.com/auth/developerprofiles.award">
    <meta property="og:site_name" content="TensorFlow">
    <meta property="og:type" content="website"><meta name="theme-color" content="#ff6f00"><meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <link rel="manifest" href="/_pwa/tensorflow/manifest.json"
          crossorigin="use-credentials">
    <link rel="preconnect" href="//www.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="//apis.google.com" crossorigin>
    <link rel="preconnect" href="//www.google-analytics.com" crossorigin><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap">
      <link rel="stylesheet"
            href="//fonts.googleapis.com/css2?family=Material+Icons&family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&display=block"><link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/css/app.css">
      <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/images/apple-touch-icon-180x180.png"><link rel="canonical" href="https://www.tensorflow.org/guide/create_op"><link rel="search" type="application/opensearchdescription+xml"
            title="TensorFlow" href="https://www.tensorflow.org/s/opensearch.xml">
      <link rel="alternate" hreflang="en"
          href="https://www.tensorflow.org/guide/create_op" /><link rel="alternate" hreflang="x-default" href="https://www.tensorflow.org/guide/create_op" /><link rel="alternate" hreflang="ar"
          href="https://www.tensorflow.org/guide/create_op?hl=ar" /><link rel="alternate" hreflang="bn"
          href="https://www.tensorflow.org/guide/create_op?hl=bn" /><link rel="alternate" hreflang="zh-Hans"
          href="https://www.tensorflow.org/guide/create_op?hl=zh-cn" /><link rel="alternate" hreflang="fa"
          href="https://www.tensorflow.org/guide/create_op?hl=fa" /><link rel="alternate" hreflang="fr"
          href="https://www.tensorflow.org/guide/create_op?hl=fr" /><link rel="alternate" hreflang="he"
          href="https://www.tensorflow.org/guide/create_op?hl=he" /><link rel="alternate" hreflang="hi"
          href="https://www.tensorflow.org/guide/create_op?hl=hi" /><link rel="alternate" hreflang="id"
          href="https://www.tensorflow.org/guide/create_op?hl=id" /><link rel="alternate" hreflang="it"
          href="https://www.tensorflow.org/guide/create_op?hl=it" /><link rel="alternate" hreflang="ja"
          href="https://www.tensorflow.org/guide/create_op?hl=ja" /><link rel="alternate" hreflang="ko"
          href="https://www.tensorflow.org/guide/create_op?hl=ko" /><link rel="alternate" hreflang="pl"
          href="https://www.tensorflow.org/guide/create_op?hl=pl" /><link rel="alternate" hreflang="pt-BR"
          href="https://www.tensorflow.org/guide/create_op?hl=pt-br" /><link rel="alternate" hreflang="pt"
          href="https://www.tensorflow.org/guide/create_op?hl=pt" /><link rel="alternate" hreflang="ru"
          href="https://www.tensorflow.org/guide/create_op?hl=ru" /><link rel="alternate" hreflang="es"
          href="https://www.tensorflow.org/guide/create_op?hl=es" /><link rel="alternate" hreflang="es-419"
          href="https://www.tensorflow.org/guide/create_op?hl=es-419" /><link rel="alternate" hreflang="th"
          href="https://www.tensorflow.org/guide/create_op?hl=th" /><link rel="alternate" hreflang="tr"
          href="https://www.tensorflow.org/guide/create_op?hl=tr" /><link rel="alternate" hreflang="vi"
          href="https://www.tensorflow.org/guide/create_op?hl=vi" /><title>Create an op &nbsp;|&nbsp; TensorFlow Core</title>

<meta property="og:title" content="Create an op &nbsp;|&nbsp; TensorFlow Core"><meta property="og:url" content="https://www.tensorflow.org/guide/create_op"><meta property="og:image" content="https://www.tensorflow.org/static/images/tf_logo_social.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="675"><meta property="og:locale" content="en"><meta name="twitter:card" content="summary_large_image"><script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    
    "headline": "Create an op"
  }
</script><script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [{
      "@type": "ListItem",
      "position": 1,
      "name": "TensorFlow Core",
      "item": "https://www.tensorflow.org/tutorials"
    },{
      "@type": "ListItem",
      "position": 2,
      "name": "Create an op",
      "item": "https://www.tensorflow.org/guide/create_op"
    }]
  }
  </script>
  

  

  


    
      <link rel="stylesheet" href="/extras.css"></head>
  <body class=""
        template="page"
        theme="tensorflow-theme"
        type="article"
        
        
        
        layout="docs"
        
        
        
        
        display-toc
        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
  
    <section class="devsite-wrapper">
      
      <devsite-cookie-notification-bar></devsite-cookie-notification-bar>
      <devsite-header role="banner">
  
    























<div class="devsite-header--inner nocontent">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Open menu">
        </button>
        <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="tensorFlow" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/images/lockup.svg" class="devsite-site-logo" alt="TensorFlow">
  </picture>
  
</a>



  
  
  <span class="devsite-product-name">
    <ul class="devsite-breadcrumb-list"
  >
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
    
  </li>
  
</ul>
  </span>

</div>
        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
            
              
              
  <devsite-tabs class="upper-tabs">

    <nav class="devsite-tabs-wrapper" aria-label="Upper tabs">
      
        
          <tab  >
            
    <a href="https://www.tensorflow.org/install"
      track-metadata-eventdetail="https://www.tensorflow.org/install"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - install"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Install"
         
           track-name="install"
         
       >
    Install
  
    </a>
  
  
          </tab>
        
      
        
          <tab class="devsite-dropdown
    
    devsite-active
    
    ">
  
    <a href="https://www.tensorflow.org/learn"
      track-metadata-eventdetail="https://www.tensorflow.org/learn"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - learn"
       track-metadata-module="primary nav"
       aria-label="Learn, selected" 
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Learn"
         
           track-name="learn"
         
       >
    Learn
  
    </a>
  
  
    <a href="#"
       role="button"
       aria-haspopup="true"
       aria-expanded="false"
       aria-label="Dropdown menu for Learn"
       track-type="nav"
       track-metadata-eventdetail="https://www.tensorflow.org/learn"
       track-metadata-position="nav - learn"
       track-metadata-module="primary nav"
       
        
          data-category="Site-Wide Custom Events"
        
          data-label="Tab: Learn"
        
          track-name="learn"
        
      
       class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>
  
  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden>
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    tfo-menu-column-learn">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/learn"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/learn"
                     track-metadata-position="nav - learn"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Introduction
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      New to TensorFlow?
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/tutorials"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/tutorials"
                     track-metadata-position="nav - learn"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Tutorials
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Learn how to use TensorFlow with end-to-end examples
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/guide"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/guide"
                     track-metadata-position="nav - learn"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Guide
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Learn framework concepts and components
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/learn-ml"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/resources/learn-ml"
                     track-metadata-position="nav - learn"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Learn ML
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Educational resources to master your path with TensorFlow
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab class="devsite-dropdown
    
    
    
    ">
  
    <a href="https://www.tensorflow.org/api"
      track-metadata-eventdetail="https://www.tensorflow.org/api"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - api"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: API"
         
           track-name="api"
         
       >
    API
  
    </a>
  
  
    <a href="#"
       role="button"
       aria-haspopup="true"
       aria-expanded="false"
       aria-label="Dropdown menu for API"
       track-type="nav"
       track-metadata-eventdetail="https://www.tensorflow.org/api"
       track-metadata-position="nav - api"
       track-metadata-module="primary nav"
       
        
          data-category="Site-Wide Custom Events"
        
          data-label="Tab: API"
        
          track-name="api"
        
      
       class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>
  
  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden>
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/api/stable"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/api/stable"
                     track-metadata-position="nav - api"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow (v2.16.1)
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/versions"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/versions"
                     track-metadata-position="nav - api"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Versions…
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://js.tensorflow.org/api/latest/"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://js.tensorflow.org/api/latest/"
                     track-metadata-position="nav - api"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow.js
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/lite/api_docs"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/lite/api_docs"
                     track-metadata-position="nav - api"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow Lite
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/tfx/api_docs"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/tfx/api_docs"
                     track-metadata-position="nav - api"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TFX
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab class="devsite-dropdown
    
    
    
    ">
  
    <a href="https://www.tensorflow.org/resources/models-datasets"
      track-metadata-eventdetail="https://www.tensorflow.org/resources/models-datasets"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - ecosystem"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Ecosystem"
         
           track-name="ecosystem"
         
       >
    Ecosystem
  
    </a>
  
  
    <a href="#"
       role="button"
       aria-haspopup="true"
       aria-expanded="false"
       aria-label="Dropdown menu for Ecosystem"
       track-type="nav"
       track-metadata-eventdetail="https://www.tensorflow.org/resources/models-datasets"
       track-metadata-position="nav - ecosystem"
       track-metadata-module="primary nav"
       
        
          data-category="Site-Wide Custom Events"
        
          data-label="Tab: Ecosystem"
        
          track-name="ecosystem"
        
      
       class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>
  
  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden>
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
                <li class="devsite-nav-title" role="heading" tooltip>LIBRARIES</li>
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/js"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/js"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="libraries"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow.js
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Develop web ML applications in JavaScript
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/lite"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/lite"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="libraries"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TensorFlow Lite
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Deploy ML on mobile, microcontrollers and other edge devices
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/tfx"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/tfx"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="libraries"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      TFX
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Build production ML pipelines
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/libraries-extensions"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/resources/libraries-extensions"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="libraries"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      All libraries
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Create advanced models and extend TensorFlow
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
                <li class="devsite-nav-title" role="heading" tooltip>RESOURCES</li>
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/models-datasets"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/resources/models-datasets"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="resources"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Models & datasets
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Pre-trained models and datasets built by Google and the community
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/tools"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/resources/tools"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="resources"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Tools
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Tools to support and accelerate TensorFlow workflows
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/responsible_ai"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/responsible_ai"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="resources"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Responsible AI
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Resources for every stage of the ML workflow
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/resources/recommendation-systems"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/resources/recommendation-systems"
                     track-metadata-position="nav - ecosystem"
                     track-metadata-module="tertiary nav"
                     
                       track-metadata-module_headline="resources"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Recommendation systems
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Build recommendation systems with open source tools
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab class="devsite-dropdown
    
    
    
    ">
  
    <a href="https://www.tensorflow.org/community"
      track-metadata-eventdetail="https://www.tensorflow.org/community"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - community"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Community"
         
           track-name="community"
         
       >
    Community
  
    </a>
  
  
    <a href="#"
       role="button"
       aria-haspopup="true"
       aria-expanded="false"
       aria-label="Dropdown menu for Community"
       track-type="nav"
       track-metadata-eventdetail="https://www.tensorflow.org/community"
       track-metadata-position="nav - community"
       track-metadata-module="primary nav"
       
        
          data-category="Site-Wide Custom Events"
        
          data-label="Tab: Community"
        
          track-name="community"
        
      
       class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>
  
  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden>
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/community/groups"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/community/groups"
                     track-metadata-position="nav - community"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Groups
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      User groups, interest groups and mailing lists
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/community/contribute"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/community/contribute"
                     track-metadata-position="nav - community"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Contribute
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Guide for contributing to code and documentation
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://blog.tensorflow.org/"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://blog.tensorflow.org/"
                     track-metadata-position="nav - community"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Blog
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Stay up to date with all things TensorFlow
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://discuss.tensorflow.org"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://discuss.tensorflow.org"
                     track-metadata-position="nav - community"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Forum
                    </div>
                    
                    <div class="devsite-nav-item-description">
                      Discussion platform for the TensorFlow community
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
        
          <tab class="devsite-dropdown
    
    
    
    ">
  
    <a href="https://www.tensorflow.org/about"
      track-metadata-eventdetail="https://www.tensorflow.org/about"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - why tensorflow"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Why TensorFlow"
         
           track-name="why tensorflow"
         
       >
    Why TensorFlow
  
    </a>
  
  
    <a href="#"
       role="button"
       aria-haspopup="true"
       aria-expanded="false"
       aria-label="Dropdown menu for Why TensorFlow"
       track-type="nav"
       track-metadata-eventdetail="https://www.tensorflow.org/about"
       track-metadata-position="nav - why tensorflow"
       track-metadata-module="primary nav"
       
        
          data-category="Site-Wide Custom Events"
        
          data-label="Tab: Why TensorFlow"
        
          track-name="why tensorflow"
        
      
       class="devsite-tabs-dropdown-toggle devsite-icon devsite-icon-arrow-drop-down"></a>
  
  <div class="devsite-tabs-dropdown" aria-label="submenu" hidden>
    
    <div class="devsite-tabs-dropdown-content">
      
        <div class="devsite-tabs-dropdown-column
                    ">
          
            <ul class="devsite-tabs-dropdown-section
                       ">
              
              
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/about"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/about"
                     track-metadata-position="nav - why tensorflow"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      About
                    </div>
                    
                  </a>
                </li>
              
                <li class="devsite-nav-item">
                  <a href="https://www.tensorflow.org/about/case-studies"
                    
                     track-type="nav"
                     track-metadata-eventdetail="https://www.tensorflow.org/about/case-studies"
                     track-metadata-position="nav - why tensorflow"
                     track-metadata-module="tertiary nav"
                     
                     tooltip
                  >
                    
                    <div class="devsite-nav-item-title">
                      Case studies
                    </div>
                    
                  </a>
                </li>
              
            </ul>
          
        </div>
      
    </div>
  </div>
</tab>
        
      
    </nav>

  </devsite-tabs>

            
           </div>
          
<devsite-search
    enable-signin
    enable-search
    enable-suggestions
      enable-query-completion
    
    
    project-name="TensorFlow Core"
    tenant-name="TensorFlow"
    
    
    
    
    
    >
  <form class="devsite-search-form" action="https://www.tensorflow.org/s/results" method="GET">
    <div class="devsite-search-container">
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              
              aria-label="Open search"></button>
      <div class="devsite-searchbox">
        <input
          aria-activedescendant=""
          aria-autocomplete="list"
          
          aria-label="Search"
          aria-expanded="false"
          aria-haspopup="listbox"
          autocomplete="off"
          class="devsite-search-field devsite-search-query"
          name="q"
          
          placeholder="Search"
          role="combobox"
          type="text"
          value=""
          >
          <div class="devsite-search-image material-icons" aria-hidden="true">
            
          </div>
          <div class="devsite-search-shortcut-icon-container" aria-hidden="true">
            <kbd class="devsite-search-shortcut-icon">/</kbd>
          </div>
      </div>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          
          aria-label="Close search"></button>
</devsite-search>

        </div>

        

        

        

        
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es"
        >Español</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Español – América Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Français</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="it"
        >Italiano</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt"
        >Português</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Português – Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Tiếng Việt</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="tr"
        >Türkçe</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ru"
        >Русский</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="he"
        >עברית</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ar"
        >العربيّة</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fa"
        >فارسی</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="hi"
        >हिंदी</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="bn"
        >বাংলা</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="th"
        >ภาษาไทย</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >中文 – 简体</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >日本語</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>


        
          
  <a class="devsite-header-link devsite-top-button button gc-analytics-event"
     href="//github.com/tensorflow"
     data-category="Site-Wide Custom Events"
     data-label="Site header link"
     >
    GitHub
  </a>
  
        

        
          
          
          <devsite-user 
                        
                        
                          enable-profiles
                        
                        
                        id="devsite-user">
            
              
              <span class="button devsite-top-button" aria-hidden="true" visually-hidden>Sign in</span>
            
        </devsite-user>
           
        
      </div>
    </div>
  </div>



  <div class="devsite-collapsible-section
    ">
    <div class="devsite-header-background">
      
        
          <div class="devsite-product-id-row"
           >
            <div class="devsite-product-description-row">
              
                
                  
                  
                  <ul class="devsite-breadcrumb-list"
  >
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
  <a href="https://www.tensorflow.org/tutorials"
      
        class="devsite-breadcrumb-link gc-analytics-event"
      
        data-category="Site-Wide Custom Events"
      
        data-label="Lower Header"
      
        data-value="1"
      
        track-type="globalNav"
      
        track-name="breadcrumb"
      
        track-metadata-position="1"
      
        track-metadata-eventdetail="TensorFlow Core"
      
    >
    
        TensorFlow Core
      
  </a>
  
    
  </li>
  
</ul>
                
              
              
            </div>
            
          </div>
          
        
      
      
        <div class="devsite-doc-set-nav-row">
          
          
            
            
  <devsite-tabs class="lower-tabs">

    <nav class="devsite-tabs-wrapper" aria-label="Lower tabs">
      
        
          <tab  >
            
    <a href="https://www.tensorflow.org/tutorials"
      track-metadata-eventdetail="https://www.tensorflow.org/tutorials"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - tutorials"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Tutorials"
         
           track-name="tutorials"
         
       >
    Tutorials
  
    </a>
  
  
          </tab>
        
      
        
          <tab  class="devsite-active">
            
    <a href="https://www.tensorflow.org/guide"
      track-metadata-eventdetail="https://www.tensorflow.org/guide"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - guide"
       track-metadata-module="primary nav"
       aria-label="Guide, selected" 
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Guide"
         
           track-name="guide"
         
       >
    Guide
  
    </a>
  
  
          </tab>
        
      
        
          <tab  >
            
    <a href="https://www.tensorflow.org/guide/migrate"
      track-metadata-eventdetail="https://www.tensorflow.org/guide/migrate"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - migrate to tf2"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: Migrate to TF2"
         
           track-name="migrate to tf2"
         
       >
    Migrate to TF2
  
    </a>
  
  
          </tab>
        
      
        
          <tab  >
            
    <a href="https://github.com/tensorflow/docs/tree/master/site/en/r1"
      track-metadata-eventdetail="https://github.com/tensorflow/docs/tree/master/site/en/r1"
    
       class="devsite-tabs-content gc-analytics-event "
       track-type="nav"
       track-metadata-position="nav - tf 1 ↗"
       track-metadata-module="primary nav"
       
       
         
           data-category="Site-Wide Custom Events"
         
           data-label="Tab: TF 1 ↗"
         
           track-name="tf 1 ↗"
         
       >
    TF 1 ↗
  
    </a>
  
  
          </tab>
        
      
    </nav>

  </devsite-tabs>

          
          
        </div>
      
    </div>
  </div>

</div>



  

  
</devsite-header>
      <devsite-book-nav scrollbars >
        
          





















<div class="devsite-book-nav-filter"
     >
  <span class="filter-list-icon material-icons" aria-hidden="true"></span>
  <input type="text"
         placeholder="Filter"
         
         aria-label="Type to filter"
         role="searchbox">
  
  <span class="filter-clear-button hidden"
        data-title="Clear filter"
        aria-label="Clear filter"
        role="button"
        tabindex="0"></span>
</div>

<nav class="devsite-book-nav devsite-nav nocontent"
     aria-label="Side menu">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">

  <a href="/" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo" track-type="globalNav"
   track-name="tensorFlow" track-metadata-position="nav"
   track-metadata-eventDetail="nav">
  
  <picture>
    
    <img src="https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/images/lockup.svg" class="devsite-site-logo" alt="TensorFlow">
  </picture>
  
</a>


  
      <span class="devsite-product-name">
        
        
        <ul class="devsite-breadcrumb-list"
  >
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
      
    
  </li>
  
</ul>
      </span>
    

</div>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
      
        <ul class="devsite-nav-list">
          
            <li class="devsite-nav-item">
              
  
  <a href="/install"
    
       class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Install"
      
        track-name="install"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Install"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Install
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          >
    </span>
    
  
  </a>
  

  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/learn"
    
       class="devsite-nav-title gc-analytics-event
              
              devsite-nav-active"
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Learn"
      
        track-name="learn"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Learn"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Learn
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Learn"
      
        track-name="learn"
      
    >
  
    <span class="devsite-nav-text" tooltip menu="Learn">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="Learn">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
                <ul class="devsite-nav-responsive-tabs">
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="/tutorials"
    
       class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Tutorials"
      
        track-name="tutorials"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Tutorials"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Tutorials
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          >
    </span>
    
  
  </a>
  

  
                    </li>
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="/guide"
    
       class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              devsite-nav-active"
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Guide"
      
        track-name="guide"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Guide"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip menu="_book">
      Guide
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="_book">
    </span>
    
  
  </a>
  

  
                    </li>
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="/guide/migrate"
    
       class="devsite-nav-title gc-analytics-event
              devsite-nav-has-children
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Migrate to TF2"
      
        track-name="migrate to tf2"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Migrate to TF2"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Migrate to TF2
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          >
    </span>
    
  
  </a>
  

  
                    </li>
                  
                    
                    
                    
                    <li class="devsite-nav-item">
                      
  
  <a href="https://github.com/tensorflow/docs/tree/master/site/en/r1"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: TF 1 ↗"
      
        track-name="tf 1 ↗"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TF 1 ↗"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TF 1 ↗
   </span>
    
  
  </a>
  

  
                    </li>
                  
                </ul>
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/api"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: API"
      
        track-name="api"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: API"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      API
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: API"
      
        track-name="api"
      
    >
  
    <span class="devsite-nav-text" tooltip menu="API">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="API">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/resources/models-datasets"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Ecosystem"
      
        track-name="ecosystem"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Ecosystem"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Ecosystem
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Ecosystem"
      
        track-name="ecosystem"
      
    >
  
    <span class="devsite-nav-text" tooltip menu="Ecosystem">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="Ecosystem">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/community"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Community"
      
        track-name="community"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Community"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Community
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Community"
      
        track-name="community"
      
    >
  
    <span class="devsite-nav-text" tooltip menu="Community">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="Community">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
            <li class="devsite-nav-item">
              
  
  <a href="/about"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Why TensorFlow"
      
        track-name="why tensorflow"
      
    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Why TensorFlow"
     track-type="globalNav"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Why TensorFlow
   </span>
    
  
  </a>
  

  
    <ul class="devsite-nav-responsive-tabs devsite-nav-has-menu
               ">
      
<li class="devsite-nav-item">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    
      
        data-category="Site-Wide Custom Events"
      
        data-label="Tab: Why TensorFlow"
      
        track-name="why tensorflow"
      
    >
  
    <span class="devsite-nav-text" tooltip menu="Why TensorFlow">
      More
   </span>
    
    <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="Why TensorFlow">
    </span>
    
  
  </span>
  

</li>

    </ul>
  
              
            </li>
          
          
    
<li class="devsite-nav-item">

  
  <a href="//github.com/tensorflow"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: GitHub"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      GitHub
   </span>
    
  
  </a>
  

</li>

  
          
        </ul>
      
    </div>
    
      <div class="devsite-mobile-nav-bottom">
        
          
          <ul class="devsite-nav-list" menu="_book">
            <li class="devsite-nav-item"><a href="/guide"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide"
      ><span class="devsite-nav-text" tooltip>TensorFlow guide</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>TensorFlow basics</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/basics"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/basics"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/basics"
      ><span class="devsite-nav-text" tooltip>Overview</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/tensor"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/tensor"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/tensor"
      ><span class="devsite-nav-text" tooltip>Tensors</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/variable"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/variable"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/variable"
      ><span class="devsite-nav-text" tooltip>Variables</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/autodiff"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/autodiff"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/autodiff"
      ><span class="devsite-nav-text" tooltip>Automatic differentiation</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/intro_to_graphs"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/intro_to_graphs"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/intro_to_graphs"
      ><span class="devsite-nav-text" tooltip>Graphs and functions</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/intro_to_modules"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/intro_to_modules"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/intro_to_modules"
      ><span class="devsite-nav-text" tooltip>Modules, layers, and models</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/basic_training_loops"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/basic_training_loops"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/basic_training_loops"
      ><span class="devsite-nav-text" tooltip>Training loops</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Keras</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/keras"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras"
      ><span class="devsite-nav-text" tooltip>Overview</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/sequential_model"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/sequential_model"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/sequential_model"
      ><span class="devsite-nav-text" tooltip>The Sequential model</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/functional_api"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/functional_api"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/functional_api"
      ><span class="devsite-nav-text" tooltip>The Functional API</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/training_with_built_in_methods"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/training_with_built_in_methods"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/training_with_built_in_methods"
      ><span class="devsite-nav-text" tooltip>Training &amp; evaluation with the built-in methods</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/making_new_layers_and_models_via_subclassing"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/making_new_layers_and_models_via_subclassing"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/making_new_layers_and_models_via_subclassing"
      ><span class="devsite-nav-text" tooltip>Making new layers and models via subclassing</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/serialization_and_saving"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/serialization_and_saving"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/serialization_and_saving"
      ><span class="devsite-nav-text" tooltip>Serialization and saving</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/customizing_saving_and_serialization"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/customizing_saving_and_serialization"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/customizing_saving_and_serialization"
      ><span class="devsite-nav-text" tooltip>Customizing Saving</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/preprocessing_layers"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/preprocessing_layers"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/preprocessing_layers"
      ><span class="devsite-nav-text" tooltip>Working with preprocessing layers</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/customizing_what_happens_in_fit"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/customizing_what_happens_in_fit"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/customizing_what_happens_in_fit"
      ><span class="devsite-nav-text" tooltip>Customizing what happens in fit()</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/writing_a_training_loop_from_scratch"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/writing_a_training_loop_from_scratch"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/writing_a_training_loop_from_scratch"
      ><span class="devsite-nav-text" tooltip>Writing a training loop from scratch</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/working_with_rnns"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/working_with_rnns"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/working_with_rnns"
      ><span class="devsite-nav-text" tooltip>Working with RNNs</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/understanding_masking_and_padding"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/understanding_masking_and_padding"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/understanding_masking_and_padding"
      ><span class="devsite-nav-text" tooltip>Understanding masking &amp; padding</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/writing_your_own_callbacks"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/writing_your_own_callbacks"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/writing_your_own_callbacks"
      ><span class="devsite-nav-text" tooltip>Writing your own callbacks</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/transfer_learning"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/transfer_learning"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/transfer_learning"
      ><span class="devsite-nav-text" tooltip>Transfer learning &amp; fine-tuning</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/keras/distributed_training"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/keras/distributed_training"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/keras/distributed_training"
      ><span class="devsite-nav-text" tooltip>Multi-GPU and distributed training</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading
           devsite-nav-new"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Build with Core</span><span class="devsite-nav-icon material-icons"
        data-icon="new"
        data-title="New!"
        aria-hidden="true"></span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/core"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core"
      ><span class="devsite-nav-text" tooltip>Overview</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/core/quickstart_core"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core/quickstart_core"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core/quickstart_core"
      ><span class="devsite-nav-text" tooltip>Quickstart for Core</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/core/logistic_regression_core"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core/logistic_regression_core"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core/logistic_regression_core"
      ><span class="devsite-nav-text" tooltip>Logistic regression</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/core/mlp_core"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core/mlp_core"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core/mlp_core"
      ><span class="devsite-nav-text" tooltip>Multilayer perceptrons</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/core/matrix_core"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core/matrix_core"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core/matrix_core"
      ><span class="devsite-nav-text" tooltip>Matrix approximation</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/core/optimizers_core"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core/optimizers_core"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core/optimizers_core"
      ><span class="devsite-nav-text" tooltip>Custom optimizers</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-experimental"><a href="/guide/core/distribution"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/core/distribution"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/core/distribution"
      ><span class="devsite-nav-text" tooltip>DTensor with Core APIs</span><span class="devsite-nav-icon material-icons"
        data-icon="experimental"
        data-title="Experimental!"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>TensorFlow in depth</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/tensor_slicing"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/tensor_slicing"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/tensor_slicing"
      ><span class="devsite-nav-text" tooltip>Tensor slicing</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/advanced_autodiff"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/advanced_autodiff"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/advanced_autodiff"
      ><span class="devsite-nav-text" tooltip>Advanced autodiff</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/ragged_tensor"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/ragged_tensor"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/ragged_tensor"
      ><span class="devsite-nav-text" tooltip>Ragged tensor</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/sparse_tensor"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/sparse_tensor"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/sparse_tensor"
      ><span class="devsite-nav-text" tooltip>Sparse tensor</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/random_numbers"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/random_numbers"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/random_numbers"
      ><span class="devsite-nav-text" tooltip>Random number generation</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-experimental"><a href="/guide/tf_numpy"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/tf_numpy"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/tf_numpy"
      ><span class="devsite-nav-text" tooltip>NumPy API</span><span class="devsite-nav-icon material-icons"
        data-icon="experimental"
        data-title="Experimental!"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item
           devsite-nav-nightly"><a href="/guide/tf_numpy_type_promotion"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/tf_numpy_type_promotion"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/tf_numpy_type_promotion"
      ><span class="devsite-nav-text" tooltip>NumPy API Type Promotion</span><span class="devsite-nav-icon material-icons"
        data-icon="nightly"
        data-title="Nightly build only"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item
           devsite-nav-experimental"><a href="/guide/dtensor_overview"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/dtensor_overview"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/dtensor_overview"
      ><span class="devsite-nav-text" tooltip>DTensor concepts</span><span class="devsite-nav-icon material-icons"
        data-icon="experimental"
        data-title="Experimental!"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item"><a href="/guide/effective_tf2"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/effective_tf2"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/effective_tf2"
      ><span class="devsite-nav-text" tooltip>Thinking in TensorFlow 2</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Customization</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/create_op"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/create_op"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/create_op"
      ><span class="devsite-nav-text" tooltip>Create an op</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-experimental"><a href="/guide/extension_type"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/extension_type"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/extension_type"
      ><span class="devsite-nav-text" tooltip>Extension types</span><span class="devsite-nav-icon material-icons"
        data-icon="experimental"
        data-title="Experimental!"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Data input pipelines</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/data"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/data"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/data"
      ><span class="devsite-nav-text" tooltip>tf.data</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/data_performance"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/data_performance"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/data_performance"
      ><span class="devsite-nav-text" tooltip>Optimize pipeline performance</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/data_performance_analysis"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/data_performance_analysis"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/data_performance_analysis"
      ><span class="devsite-nav-text" tooltip>Analyze pipeline performance</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Import and export</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/checkpoint"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/checkpoint"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/checkpoint"
      ><span class="devsite-nav-text" tooltip>Checkpoint</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/saved_model"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/saved_model"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/saved_model"
      ><span class="devsite-nav-text" tooltip>SavedModel</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-new"><a href="/guide/jax2tf"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/jax2tf"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/jax2tf"
      ><span class="devsite-nav-text" tooltip>Import a JAX model using JAX2TF</span><span class="devsite-nav-icon material-icons"
        data-icon="new"
        data-title="New!"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Accelerators</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/distributed_training"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/distributed_training"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/distributed_training"
      ><span class="devsite-nav-text" tooltip>Distributed training</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/gpu"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/gpu"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/gpu"
      ><span class="devsite-nav-text" tooltip>GPU</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/tpu"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/tpu"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/tpu"
      ><span class="devsite-nav-text" tooltip>TPU</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Performance</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/function"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/function"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/function"
      ><span class="devsite-nav-text" tooltip>Better performance with tf.function</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/profiler"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/profiler"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/profiler"
      ><span class="devsite-nav-text" tooltip>Profile TensorFlow performance</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/gpu_performance_analysis"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/gpu_performance_analysis"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/gpu_performance_analysis"
      ><span class="devsite-nav-text" tooltip>Optimize GPU Performance</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/graph_optimization"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/graph_optimization"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/graph_optimization"
      ><span class="devsite-nav-text" tooltip>Graph optimization</span></a></li>

  <li class="devsite-nav-item"><a href="/guide/mixed_precision"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/mixed_precision"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/mixed_precision"
      ><span class="devsite-nav-text" tooltip>Mixed precision</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading
           devsite-nav-new"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Model Garden</span><span class="devsite-nav-icon material-icons"
        data-icon="new"
        data-title="New!"
        aria-hidden="true"></span>
      </div></li>

  <li class="devsite-nav-item"><a href="/tfmodels"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels"
      ><span class="devsite-nav-text" tooltip>Overview</span></a></li>

  <li class="devsite-nav-item"><a href="/tfmodels/orbit"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels/orbit"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels/orbit"
      ><span class="devsite-nav-text" tooltip>Training with Orbit</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-external"><a href="/tfmodels/nlp"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels/nlp"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels/nlp"
      ><span class="devsite-nav-text" tooltip>TFModels - NLP</span><span class="devsite-nav-icon material-icons"
        data-icon="external"
        data-title="External"
        aria-hidden="true"></span></a></li>

  <li class="devsite-nav-item"><a href="/tfmodels/vision/image_classification"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels/vision/image_classification"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels/vision/image_classification"
      ><span class="devsite-nav-text" tooltip>Example: Image classification</span></a></li>

  <li class="devsite-nav-item"><a href="/tfmodels/vision/object_detection"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels/vision/object_detection"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels/vision/object_detection"
      ><span class="devsite-nav-text" tooltip>Example: Object Detection</span></a></li>

  <li class="devsite-nav-item"><a href="/tfmodels/vision/semantic_segmentation"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels/vision/semantic_segmentation"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels/vision/semantic_segmentation"
      ><span class="devsite-nav-text" tooltip>Example: Semantic Segmentation</span></a></li>

  <li class="devsite-nav-item"><a href="/tfmodels/vision/instance_segmentation"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /tfmodels/vision/instance_segmentation"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/tfmodels/vision/instance_segmentation"
      ><span class="devsite-nav-text" tooltip>Example: Instance Segmentation</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading
           devsite-nav-deprecated"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Estimators</span><span class="devsite-nav-icon material-icons"
        data-icon="deprecated"
        data-title="Deprecated"
        aria-hidden="true"></span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/estimator"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/estimator"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/estimator"
      ><span class="devsite-nav-text" tooltip>Estimator overview</span></a></li>

  <li class="devsite-nav-item
           devsite-nav-heading"><div class="devsite-nav-title devsite-nav-title-no-path">
        <span class="devsite-nav-text" tooltip>Appendix</span>
      </div></li>

  <li class="devsite-nav-item"><a href="/guide/versions"
        class="devsite-nav-title gc-analytics-event"
        data-category="Site-Wide Custom Events"
        data-label="Book nav link, pathname: /guide/versions"
        track-type="bookNav"
        track-name="click"
        track-metadata-eventdetail="/guide/versions"
      ><span class="devsite-nav-text" tooltip>Version compatibility</span></a></li>
          </ul>
        
        
          
    
  
    
      
      <ul class="devsite-nav-list" menu="Learn"
          aria-label="Side menu" hidden>
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="/learn"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Introduction"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Introduction
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/tutorials"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Tutorials"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Tutorials
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/guide"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Guide"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Guide
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/resources/learn-ml"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Learn ML"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Learn ML
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="API"
          aria-label="Side menu" hidden>
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="/api/stable"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TensorFlow (v2.16.1)"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TensorFlow (v2.16.1)
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/versions"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Versions…"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Versions…
   </span>
    
  
  </a>
  

</li>

            
          
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="https://js.tensorflow.org/api/latest/"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TensorFlow.js"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TensorFlow.js
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/lite/api_docs"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TensorFlow Lite"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TensorFlow Lite
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/tfx/api_docs"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TFX"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TFX
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="Ecosystem"
          aria-label="Side menu" hidden>
        
          
            
              
<li class="devsite-nav-item devsite-nav-heading">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    >
  
    <span class="devsite-nav-text" tooltip >
      LIBRARIES
   </span>
    
  
  </span>
  

</li>

            
            
              
<li class="devsite-nav-item">

  
  <a href="/js"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TensorFlow.js"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TensorFlow.js
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/lite"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TensorFlow Lite"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TensorFlow Lite
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/tfx"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: TFX"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      TFX
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/resources/libraries-extensions"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: All libraries"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      All libraries
   </span>
    
  
  </a>
  

</li>

            
          
        
          
            
              
<li class="devsite-nav-item devsite-nav-heading">

  
  <span
    
       class="devsite-nav-title"
       tooltip
    
    >
  
    <span class="devsite-nav-text" tooltip >
      RESOURCES
   </span>
    
  
  </span>
  

</li>

            
            
              
<li class="devsite-nav-item">

  
  <a href="/resources/models-datasets"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Models &amp; datasets"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Models &amp; datasets
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/resources/tools"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Tools"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Tools
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/responsible_ai"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Responsible AI"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Responsible AI
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/resources/recommendation-systems"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Recommendation systems"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Recommendation systems
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="Community"
          aria-label="Side menu" hidden>
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="/community/groups"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Groups"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Groups
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/community/contribute"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Contribute"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Contribute
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://blog.tensorflow.org/"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Blog"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Blog
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="https://discuss.tensorflow.org"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Forum"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Forum
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
    
      
      <ul class="devsite-nav-list" menu="Why TensorFlow"
          aria-label="Side menu" hidden>
        
          
            
            
              
<li class="devsite-nav-item">

  
  <a href="/about"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: About"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      About
   </span>
    
  
  </a>
  

</li>

            
              
<li class="devsite-nav-item">

  
  <a href="/about/case-studies"
    
       class="devsite-nav-title gc-analytics-event
              
              "
    

    
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Case studies"
     track-type="navMenu"
     track-metadata-eventDetail="globalMenu"
     track-metadata-position="nav">
  
    <span class="devsite-nav-text" tooltip >
      Case studies
   </span>
    
  
  </a>
  

</li>

            
          
        
      </ul>
    
  
        
        
          
    
  
    
  
    
  
    
  
        
      </div>
    
  </div>
</nav>
        
      </devsite-book-nav>
      <section id="gc-wrapper">
        <main role="main" class="devsite-main-content"
            
              has-book-nav
              has-sidebar
            >
          
          
          <div class="devsite-sidebar">
            <div class="devsite-sidebar-content">
                
                <devsite-toc class="devsite-nav"
                            role="navigation"
                            aria-label="On this page"
                            depth="2"
                            scrollbars
                  ></devsite-toc>
                <devsite-recommendations-sidebar class="nocontent devsite-nav">
                </devsite-recommendations-sidebar>
            </div>
          </div>
          
          <devsite-content>
            
              

















<article class="devsite-article"><style>
      /* Styles inlined from /site-assets/css/style.css */
/* override theme */
table img {
  max-width: 100%;
}

/* .devsite-terminal virtualenv prompt */
.tfo-terminal-venv::before {
  content: "(venv) $ " !important;
}

/* .devsite-terminal root prompt */
.tfo-terminal-root::before {
  content: "# " !important;
}

/* Used in links for type annotations in function/method signatures */
.tfo-signature-link a,
.tfo-signature-link a:visited,
.tfo-signature-link a:hover,
.tfo-signature-link a:focus,
.tfo-signature-link a:hover *,
.tfo-signature-link a:focus * {
  text-decoration: none !important;
}

.tfo-signature-link a,
.tfo-signature-link a:visited {
  border-bottom: 1px dotted #1a73e8;
}

.tfo-signature-link a:focus {
  border-bottom-style: solid;
}

/* .devsite-terminal Windows prompt */
.tfo-terminal-windows::before {
  content: "C:\\> " !important;
}

/* .devsite-terminal Windows prompt w/ virtualenv */
.tfo-terminal-windows-venv::before {
  content: "(venv) C:\\> " !important;
}

.tfo-diff-green-one-level + * {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-green + * > * {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-green-list + ul > li:first-of-type {
  background: rgba(175, 245, 162, .6)  !important;
}

.tfo-diff-red-one-level + * {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

.tfo-diff-red + * > * {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

.tfo-diff-red-list + ul > li:first-of-type {
  background: rgba(255, 230, 230, .6)  !important;
  text-decoration: line-through  !important;
}

devsite-code .tfo-notebook-code-cell-output {
  max-height: 300px;
  overflow: auto;
  background: rgba(255, 247, 237, 1);  /* orange bg to distinguish from input code cells */
}

devsite-code .tfo-notebook-code-cell-output + .devsite-code-buttons-container button {
  background: rgba(255, 247, 237, .7);  /* orange bg to distinguish from input code cells */
}

devsite-code[dark-code] .tfo-notebook-code-cell-output {
  background: rgba(64, 78, 103, 1);  /* medium slate */
}

devsite-code[dark-code] .tfo-notebook-code-cell-output + .devsite-code-buttons-container button {
  background: rgba(64, 78, 103, .7);  /* medium slate */
}

/* override default table styles for notebook buttons */
.devsite-table-wrapper .tfo-notebook-buttons {
  display: inline-block;
  margin-left: 3px;
  width: auto;
}

.tfo-notebook-buttons td {
  padding-left: 0;
  padding-right: 20px;
}

.tfo-notebook-buttons a,
.tfo-notebook-buttons :link,
.tfo-notebook-buttons :visited {
  border-radius: 8px;
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 1px 3px 1px rgba(60, 64, 67, .15);
  color: #202124;
  padding: 12px 17px;
  transition: box-shadow 0.2s;
}

.tfo-notebook-buttons a:hover,
.tfo-notebook-buttons a:focus {
  box-shadow: 0 1px 2px 0 rgba(60, 64, 67, .3), 0 2px 6px 2px rgba(60, 64, 67, .15);
}

.tfo-notebook-buttons tr {
  background: 0;
  border: 0;
}

/* on rendered notebook page,
   remove link to webpage since we're already here */
.tfo-notebook-buttons:not(.tfo-api) td:first-child {
  display: none;
}

.tfo-notebook-buttons td > a {
  -webkit-box-align: center;
  -ms-flex-align: center;
  align-items: center;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.tfo-notebook-buttons td > a > img {
  margin-right: 8px;
}

/* landing pages */

.tfo-landing-row-item-inset-white {
  background-color: #fff;
  padding: 32px;
}

.tfo-landing-row-item-inset-white ol,
.tfo-landing-row-item-inset-white ul {
  padding-left: 20px;
}

/* colab callout button */
.colab-callout-row devsite-code {
  border-radius: 8px 8px 0 0;
  box-shadow: none;
}

.colab-callout-footer {
  background: #e3e4e7;
  border-radius: 0 0 8px 8px;
  color: #37474f;
  padding: 20px;
}

.colab-callout-row devsite-code[dark-code] + .colab-callout-footer {
  background: #3f4f66;
}


.colab-callout-footer > .button {
  margin-top: 4px;
  color: #ff5c00;
}

.colab-callout-footer > a > span {
  vertical-align: middle;
  color: #37474f;
  padding-left: 10px;
  font-size: 14px;
}

.colab-callout-row devsite-code[dark-code] + .colab-callout-footer > a > span {
  color: #fff;
}

a.colab-button {
  background: rgba(255, 255, 255, .75);
  border: solid 1px rgba(0, 0, 0, .08);
  border-bottom-color: rgba(0, 0, 0, .15);
  border-radius: 4px;
  color: #aaa;
  display: inline-block;
  font-size: 11px !important;
  font-weight: 300;
  line-height: 16px;
  padding: 4px 8px;
  text-decoration: none;
  text-transform: uppercase;
}

a.colab-button:hover {
  background: white;
  border-color: rgba(0, 0, 0, .2);
  color: #666;
}

a.colab-button span {
  background: url(/images/colab_logo_button.svg) no-repeat 1px 1px / 20px;
  border-radius: 4px;
  display: inline-block;
  padding-left: 24px;
  text-decoration: none;
}

@media screen and (max-width: 600px) {
  .tfo-notebook-buttons td {
    display: block;
  }
}

/* guide and tutorials landing page cards and sections */

.tfo-landing-page-card {
  padding: 16px;
  box-shadow: 0 0 36px rgba(0,0,0,0.1);
  border-radius: 10px;
}

/* Page section headings */
.tfo-landing-page-heading h2, h2.tfo-landing-page-heading {
  font-family: "Google Sans", sans-serif;
  color: #425066;
  font-size: 30px;
  font-weight: 700;
  line-height: 40px;
}

/* Item title headings */
.tfo-landing-page-heading h3, h3.tfo-landing-page-heading,
.tfo-landing-page-card h3, h3.tfo-landing-page-card {
  font-family: "Google Sans", sans-serif;
  color: #425066;
  font-size: 20px;
  font-weight: 500;
  line-height: 26px;
}

/* List of tutorials notebooks for subsites */
.tfo-landing-page-resources-ul {
  padding-left: 15px
}

.tfo-landing-page-resources-ul > li {
  margin: 6px 0;
}

/* Temporary fix to hide product description in header on landing pages */
devsite-header .devsite-product-description {
  display: none;
}

      </style>
  
  
  
  
  

  <div class="devsite-article-meta nocontent" role="navigation">
    
    
    <ul class="devsite-breadcrumb-list"
  
    aria-label="Breadcrumb">
  
  <li class="devsite-breadcrumb-item
             ">
    
    
    
      
  <a href="https://www.tensorflow.org/"
      
        class="devsite-breadcrumb-link gc-analytics-event"
      
        data-category="Site-Wide Custom Events"
      
        data-label="Breadcrumbs"
      
        data-value="1"
      
        track-type="globalNav"
      
        track-name="breadcrumb"
      
        track-metadata-position="1"
      
        track-metadata-eventdetail="TensorFlow"
      
    >
    
        TensorFlow
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://www.tensorflow.org/learn"
      
        class="devsite-breadcrumb-link gc-analytics-event"
      
        data-category="Site-Wide Custom Events"
      
        data-label="Breadcrumbs"
      
        data-value="2"
      
        track-type="globalNav"
      
        track-name="breadcrumb"
      
        track-metadata-position="2"
      
        track-metadata-eventdetail=""
      
    >
    
        Learn
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://www.tensorflow.org/tutorials"
      
        class="devsite-breadcrumb-link gc-analytics-event"
      
        data-category="Site-Wide Custom Events"
      
        data-label="Breadcrumbs"
      
        data-value="3"
      
        track-type="globalNav"
      
        track-name="breadcrumb"
      
        track-metadata-position="3"
      
        track-metadata-eventdetail="TensorFlow Core"
      
    >
    
        TensorFlow Core
      
  </a>
  
    
  </li>
  
  <li class="devsite-breadcrumb-item
             ">
    
      
      <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
    
    
    
      
  <a href="https://www.tensorflow.org/guide"
      
        class="devsite-breadcrumb-link gc-analytics-event"
      
        data-category="Site-Wide Custom Events"
      
        data-label="Breadcrumbs"
      
        data-value="4"
      
        track-type="globalNav"
      
        track-name="breadcrumb"
      
        track-metadata-position="4"
      
        track-metadata-eventdetail=""
      
    >
    
        Guide
      
  </a>
  
    
  </li>
  
</ul>
    
      
    <devsite-thumb-rating position="header">
    </devsite-thumb-rating>
  
    
  </div>
  
    <h1 class="devsite-page-title" tabindex="-1">
      Create an op
      
    </h1>
  <devsite-feature-tooltip
      ack-key="AckCollectionsBookmarkTooltipDismiss"
      analytics-category="Site-Wide Custom Events"
      analytics-action-show="Callout Profile displayed"
      analytics-action-close="Callout Profile dismissed"
      analytics-label="Create Collection Callout"
      class="devsite-page-bookmark-tooltip nocontent"
      dismiss-button="true"
      id="devsite-collections-dropdown"
      
      dismiss-button-text="Dismiss"

      
      close-button-text="Got it">

    
    <devsite-bookmark></devsite-bookmark>

    <span slot="popout-heading">
      
      Stay organized with collections
    </span>
    <span slot="popout-contents">
      
      Save and categorize content based on your preferences.
    </span>
  </devsite-feature-tooltip>
  
  <div class="devsite-page-title-meta"><devsite-view-release-notes></devsite-view-release-notes></div>
  

  <devsite-toc class="devsite-nav"
    depth="2"
    devsite-toc-embedded
    >
  </devsite-toc>
  
    
  

  






<div class="devsite-article-body clearfix
  ">

  
    
<p><devsite-mathjax config="TeX-AMS-MML_SVG"></devsite-mathjax>
</p>

<!-- DO NOT EDIT! Automatically generated file. -->


<aside class="note"><strong>Note:</strong><span> To guarantee that your C++ custom ops are ABI compatible with TensorFlow&#39;s
official pip packages, please follow the guide at
<a href="https://github.com/tensorflow/custom-op">Custom op repository</a>. It has an
end-to-end code example, as well as Docker images for building and distributing
your custom ops.</span></aside>
<p>If you&#39;d like to create an op that isn&#39;t covered by the existing TensorFlow
library, we recommend that you first try writing the op in Python as
a composition of existing Python ops or functions. If that isn&#39;t possible, you
can create a custom C++ op. There are several reasons why you might want to
create a custom C++ op:</p>

<ul>
<li>It&#39;s not easy or possible to express your operation as a composition of
existing ops.</li>
<li>It&#39;s not efficient to express your operation as a composition of existing
primitives.</li>
<li>You want to hand-fuse a composition of primitives that a future compiler
would find difficult fusing.</li>
</ul>

<p>For example, imagine you want to implement something like &quot;median pooling&quot;,
similar to the &quot;MaxPool&quot; operator, but computing medians over sliding windows
instead of maximum values.  Doing this using a composition of operations may be
possible (e.g., using ExtractImagePatches and TopK), but may not be as
performance- or memory-efficient as a native operation where you can do
something more clever in a single, fused operation. As always, it is typically
first worth trying to express what you want using operator composition, only
choosing to add a new operation if that proves to be difficult or inefficient.</p>

<p>To incorporate your custom op you&#39;ll need to:</p>

<ol>
<li>Register the new op in a C++ file. Op registration defines an interface
(specification) for the op&#39;s functionality, which is independent of the
op&#39;s implementation. For example, op registration defines the op&#39;s name and
the op&#39;s inputs and outputs. It also defines the shape function
that is used for tensor shape inference.</li>
<li>Implement the op in C++. The implementation of an op is known
as a kernel, and it is the concrete implementation of the specification you
registered in Step 1. There can be multiple kernels for different input /
output types or architectures (for example, CPUs, GPUs).</li>
<li>Create a Python wrapper (optional). This wrapper is the public API that&#39;s
used to create the op in Python. A default wrapper is generated from the
op registration, which can be used directly or added to.</li>
<li>Write a function to compute gradients for the op (optional).</li>
<li>Test the op. We usually do this in Python for convenience, but you can also
test the op in C++. If you define gradients, you can verify them with the
Python <code translate="no" dir="ltr">tf.test.compute_gradient_error</code>.
See
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/python/kernel_tests/nn_ops/relu_op_test.py"><code translate="no" dir="ltr">relu_op_test.py</code></a> as
an example that tests the forward functions of Relu-like operators and
their gradients.</li>
</ol>

<h3 id="prerequisites" data-text="Prerequisites" tabindex="-1">Prerequisites</h3>

<ul>
<li>Some familiarity with C++.</li>
<li>Must have installed the
<a href="https://www.tensorflow.org/install">TensorFlow binary</a>, or must have
<a href="https://www.tensorflow.org/install/source">downloaded TensorFlow source</a>,
and be able to build it.</li>
</ul>

<h2 id="define_the_op_interface" data-text="Define the op interface" tabindex="-1">Define the op interface</h2>

<p>You define the interface of an op by registering it with the TensorFlow system.
In the registration, you specify the name of your op, its inputs (types and
names) and outputs (types and names), as well as docstrings and
any <a href="#attrs">attrs</a> the op might require.</p>

<p>To see how this works, suppose you&#39;d like to create an op that takes a tensor of
<code translate="no" dir="ltr">int32</code>s and outputs a copy of the tensor, with all but the first element set to
zero. To do this, create a file named <code translate="no" dir="ltr">zero_out.cc</code>. Then add a call to the
<code translate="no" dir="ltr">REGISTER_OP</code> macro that defines the interface for your op:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op.h</span>&#34;
<span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/shape_inference.h</span>&#34;

<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">namespace</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">tensorflow</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">([](</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InferenceContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">set_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Status</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">OK</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">});</span>
</code></pre></devsite-code>
<p>This <code translate="no" dir="ltr">ZeroOut</code> op takes one tensor <code translate="no" dir="ltr">to_zero</code> of 32-bit integers as input, and
outputs a tensor <code translate="no" dir="ltr">zeroed</code> of 32-bit integers. The op also uses a shape function
to ensure that the output tensor is the same shape as the input tensor. For
example, if the input is a tensor of shape [10, 20], then this shape function
specifies that the output shape is also [10, 20].</p>
<aside class="note"><strong>Note:</strong><span> The op name must be in CamelCase and it must be unique among all other ops
that are registered in the binary.</span></aside>
<h2 id="implement_the_kernel_for_the_op" data-text="Implement the kernel for the op" tabindex="-1">Implement the kernel for the op</h2>

<p>After you define the interface, provide one or more implementations of the op.
To create one of these kernels, create a class that extends <code translate="no" dir="ltr">OpKernel</code> and
overrides the <code translate="no" dir="ltr">Compute</code> method. The <code translate="no" dir="ltr">Compute</code> method provides one <code translate="no" dir="ltr">context</code>
argument of type <code translate="no" dir="ltr">OpKernelContext*</code>, from which you can access useful things
like the input and output tensors.</p>

<p>Add your kernel to the file you created above. The kernel might look something
like this:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op_kernel.h</span>&#34;

<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">namespace</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">tensorflow</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ZeroOutOp</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-o">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-k">explicit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZeroOutOp</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelConstruction</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{}</span>

<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Grab the input tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Tensor</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">auto</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">flat&lt;int32&gt;</span><span class="devsite-syntax-p">();</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Create an output tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">NULL</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES_OK</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">allocate_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">                                                     </span>&amp;<span class="devsite-syntax-n">output_tensor</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">auto</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_tensor</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">flat&lt;int32&gt;</span><span class="devsite-syntax-p">();</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Set all but the first element of the output tensor to 0.</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">++</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Preserve the first input value if possible.</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> &gt; </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">};</span>
</code></pre></devsite-code>
<p>After implementing your kernel, you register it with the TensorFlow system. In
the registration, you specify different constraints under which this kernel
will run. For example, you might have one kernel made for CPUs, and a separate
one for GPUs.</p>

<p>To do this for the <code translate="no" dir="ltr">ZeroOut</code> op, add the following to <code translate="no" dir="ltr">zero_out.cc</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_KERNEL_BUILDER</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">Name</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">).</span><span class="devsite-syntax-n">Device</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">DEVICE_CPU</span><span class="devsite-syntax-p">),</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZeroOutOp</span><span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<blockquote>
<aside class="special"><strong>Important:</strong><span> Instances of your OpKernel may be accessed concurrently.
  Your <code translate="no" dir="ltr">Compute</code> method must be thread-safe. Guard any access to class
  members with a mutex. Or better yet, don&#39;t share state via class members!
  Consider using a <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/resource_mgr.h"><code translate="no" dir="ltr">ResourceMgr</code></a>
  to keep track of op state.</span></aside></blockquote>

<h3 id="multi-threaded_cpu_kernels" data-text="Multi-threaded CPU kernels" tabindex="-1">Multi-threaded CPU kernels</h3>

<p>To write a multi-threaded CPU kernel, the Shard function in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/util/work_sharder.h"><code translate="no" dir="ltr">work_sharder.h</code></a>
can be used. This function shards a computation function across the
threads configured to be used for intra-op threading (see
intra_op_parallelism_threads in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/protobuf/config.proto"><code translate="no" dir="ltr">config.proto</code></a>).</p>

<h3 id="gpu_kernels" data-text="GPU kernels" tabindex="-1">GPU kernels</h3>

<p>A GPU kernel is implemented in two parts: the OpKernel and the CUDA kernel and
its launch code.</p>

<p>Sometimes the OpKernel implementation is common between a CPU and GPU kernel,
such as around inspecting inputs and allocating outputs.  In that case, a
suggested implementation is to:</p>

<ol>
<li>Define the OpKernel templated on the Device and the primitive type of the
tensor.</li>
<li>To do the actual computation of the output, the Compute function calls a
templated functor struct.</li>
<li>The specialization of that functor for the CPUDevice is defined in the same
file, but the specialization for the GPUDevice is defined in a .cu.cc file,
since it will be compiled with the CUDA compiler.</li>
</ol>

<p>Here is an example implementation.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-c1">// kernel_example.h</span>
<span class="devsite-syntax-cp">#ifndef KERNEL_EXAMPLE_H_</span>
<span class="devsite-syntax-cp">#define KERNEL_EXAMPLE_H_</span>

<span class="devsite-syntax-cp">#include &lt;unsupported/Eigen/CXX11/Tensor&gt;</span>

<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">Device</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-k">struct</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ExampleFunctor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">operator</span><span class="devsite-syntax-p">()(</span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Device</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">d</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-cp">#if GOOGLE_CUDA</span>
<span class="devsite-syntax-c1">// Partially specialize functor for GpuDevice.</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-k">struct</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ExampleFunctor&lt;Eigen</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">GpuDevice</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T&gt;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">operator</span><span class="devsite-syntax-p">()(</span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Eigen</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">GpuDevice</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">d</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-p">};</span>
<span class="devsite-syntax-cp">#endif</span>

<span class="devsite-syntax-cp">#endif KERNEL_EXAMPLE_H_</span>
</code></pre></devsite-code><div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-c1">// kernel_example.cc</span>
<span class="devsite-syntax-cp">#include &#34;kernel_example.h</span>&#34;

<span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op.h</span>&#34;
<span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/shape_inference.h</span>&#34;
<span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op_kernel.h</span>&#34;

<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">namespace</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">tensorflow</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">CPUDevice</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Eigen</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">ThreadPoolDevice</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GPUDevice</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Eigen</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">GpuDevice</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">Example</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">numbertype</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">input_times_two</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">([](</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InferenceContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">set_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Status</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">OK</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">});</span>

<span class="devsite-syntax-c1">// CPU specialization of actual computation.</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-k">struct</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ExampleFunctor&lt;CPUDevice</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T&gt;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">operator</span><span class="devsite-syntax-p">()(</span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">CPUDevice</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">d</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">++</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">];</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-c1">// OpKernel definition.</span>
<span class="devsite-syntax-c1">// template parameter &lt;T&gt; is the datatype of the tensors.</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">Device</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ExampleOp</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-o">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-k">explicit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ExampleOp</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelConstruction</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{}</span>

<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Grab the input tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Tensor</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Create an output tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">NULL</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES_OK</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">allocate_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">                                                     </span>&amp;<span class="devsite-syntax-n">output_tensor</span><span class="devsite-syntax-p">));</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Do the computation.</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">NumElements</span><span class="devsite-syntax-p">()</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">kint32max</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">errors</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InvalidArgument</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">Too</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">many</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">elements</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">tensor</span>&#34;<span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">ExampleFunctor&lt;Device</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T&gt;</span><span class="devsite-syntax-p">()(</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">eigen_device&lt;Device&gt;</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">static_cast&lt;int&gt;</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">NumElements</span><span class="devsite-syntax-p">()),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">flat&lt;T&gt;</span><span class="devsite-syntax-p">().</span><span class="devsite-syntax-n">data</span><span class="devsite-syntax-p">(),</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">output_tensor</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">flat&lt;T&gt;</span><span class="devsite-syntax-p">().</span><span class="devsite-syntax-n">data</span><span class="devsite-syntax-p">());</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-c1">// Register the CPU kernels.</span>
<span class="devsite-syntax-cp">#define REGISTER_CPU(T)                                          \</span>
<span class="devsite-syntax-cp">  REGISTER_KERNEL_BUILDER(                                       \</span>
<span class="devsite-syntax-cp">      Name(&#34;Example&#34;).Device(DEVICE_CPU).TypeConstraint&lt;T&gt;(&#34;T&#34;), \</span>
<span class="devsite-syntax-cp">      ExampleOp&lt;CPUDevice, T&gt;);</span>
<span class="devsite-syntax-n">REGISTER_CPU</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_CPU</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-c1">// Register the GPU kernels.</span>
<span class="devsite-syntax-cp">#ifdef GOOGLE_CUDA</span>
<span class="devsite-syntax-cp">#define REGISTER_GPU(T)                                          \</span>
<span class="devsite-syntax-cp">  </span><span class="devsite-syntax-cm">/* Declare explicit instantiations in kernel_example.cu.cc. */</span><span class="devsite-syntax-cp"> \</span>
<span class="devsite-syntax-cp">  extern template class ExampleFunctor&lt;GPUDevice, T&gt;;            \</span>
<span class="devsite-syntax-cp">  REGISTER_KERNEL_BUILDER(                                       \</span>
<span class="devsite-syntax-cp">      Name(&#34;Example&#34;).Device(DEVICE_GPU).TypeConstraint&lt;T&gt;(&#34;T&#34;), \</span>
<span class="devsite-syntax-cp">      ExampleOp&lt;GPUDevice, T&gt;);</span>
<span class="devsite-syntax-n">REGISTER_GPU</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_GPU</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-cp">#endif  </span><span class="devsite-syntax-c1">// GOOGLE_CUDA</span>
</code></pre></devsite-code><div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-c1">// kernel_example.cu.cc</span>
<span class="devsite-syntax-cp">#ifdef GOOGLE_CUDA</span>
<span class="devsite-syntax-cp">#define EIGEN_USE_GPU</span>
<span class="devsite-syntax-cp">#include &#34;kernel_example.h</span>&#34;
<span class="devsite-syntax-cp">#include &#34;tensorflow/core/util/gpu_kernel_helper.h</span>&#34;

<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">namespace</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nn">tensorflow</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-k">using</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GPUDevice</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Eigen</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">GpuDevice</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-c1">// Define the CUDA kernel.</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-n">__global__</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ExampleCudaKernel</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">blockIdx</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">x</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">blockDim</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">x</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">threadIdx</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">x</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">       </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">blockDim</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">x</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">gridDim</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">x</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">]</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">__ldg</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">+</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-c1">// Define the GPU implementation that launches the CUDA kernel.</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ExampleFunctor&lt;GPUDevice</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T&gt;</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-k">operator</span><span class="devsite-syntax-p">()(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">GPUDevice</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">d</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-c1">// Launch the cuda kernel.</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-c1">//</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-c1">// See core/util/gpu_kernel_helper.h for example of computing</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-c1">// block count and thread_per_block count.</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">block_count</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1024</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">thread_per_block</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">20</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-n">ExampleCudaKernel&lt;T&gt;</span>
<span class="devsite-syntax-w">      </span>&lt;&lt;&lt;<span class="devsite-syntax-n">block_count</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">thread_per_block</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">d</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">stream</span><span class="devsite-syntax-p">()&gt;&gt;&gt;(</span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-c1">// Explicitly instantiate functors for the types of OpKernels registered.</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">struct</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ExampleFunctor&lt;GPUDevice</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float&gt;</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">struct</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ExampleFunctor&lt;GPUDevice</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32&gt;</span><span class="devsite-syntax-p">;</span>

<span class="devsite-syntax-cp">#endif  </span><span class="devsite-syntax-c1">// GOOGLE_CUDA</span>
</code></pre></devsite-code>
<h2 id="build_the_op_library" data-text="Build the op library" tabindex="-1">Build the op library</h2>

<h3 id="compile_the_op_using_your_system_compiler_tensorflow_binary_installation" data-text="Compile the op using your system compiler (TensorFlow binary installation)" tabindex="-1">Compile the op using your system compiler (TensorFlow binary installation)</h3>

<p>You should be able to compile <code translate="no" dir="ltr">zero_out.cc</code> with a <code translate="no" dir="ltr">C++</code> compiler such as <code translate="no" dir="ltr">g++</code>
or <code translate="no" dir="ltr">clang</code> available on your system. The binary PIP package installs the header
files and the library that you need to compile your op in locations that are
system specific. However, the TensorFlow python library provides the
<code translate="no" dir="ltr">get_include</code> function to get the header directory, and the <code translate="no" dir="ltr">get_lib</code> directory
has a shared object to link against.
Here are the outputs of these functions on an Ubuntu machine.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Bash"><code translate="no" dir="ltr">$<span class="devsite-syntax-w"> </span>python
&gt;&gt;&gt;<span class="devsite-syntax-w"> </span>import<span class="devsite-syntax-w"> </span>tensorflow<span class="devsite-syntax-w"> </span>as<span class="devsite-syntax-w"> </span>tf
&gt;&gt;&gt;<span class="devsite-syntax-w"> </span>tf.sysconfig.get_include<span class="devsite-syntax-o">()</span>
&#39;/usr/local/lib/python3.6/site-packages/tensorflow/include&#39;
&gt;&gt;&gt;<span class="devsite-syntax-w"> </span>tf.sysconfig.get_lib<span class="devsite-syntax-o">()</span>
&#39;/usr/local/lib/python3.6/site-packages/tensorflow&#39;
</code></pre></devsite-code>
<p>Assuming you have <code translate="no" dir="ltr">g++</code> installed, here is the sequence of commands you can use
to compile your op into a dynamic library.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Bash"><code translate="no" dir="ltr"><span class="devsite-syntax-nv">TF_CFLAGS</span><span class="devsite-syntax-o">=(</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">$(</span>python<span class="devsite-syntax-w"> </span>-c<span class="devsite-syntax-w"> </span>&#39;import<span class="devsite-syntax-w"> </span>tensorflow<span class="devsite-syntax-w"> </span>as<span class="devsite-syntax-w"> </span>tf<span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span>print<span class="devsite-syntax-o">(</span>&#34;<span class="devsite-syntax-w"> </span>&#34;.join<span class="devsite-syntax-o">(</span>tf.sysconfig.get_compile_flags<span class="devsite-syntax-o">(</span><span class="devsite-syntax-k">)</span><span class="devsite-syntax-o">))&#39;)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">)</span>
<span class="devsite-syntax-nv">TF_LFLAGS</span><span class="devsite-syntax-o">=(</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">$(</span>python<span class="devsite-syntax-w"> </span>-c<span class="devsite-syntax-w"> </span>&#39;import<span class="devsite-syntax-w"> </span>tensorflow<span class="devsite-syntax-w"> </span>as<span class="devsite-syntax-w"> </span>tf<span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span>print<span class="devsite-syntax-o">(</span>&#34;<span class="devsite-syntax-w"> </span>&#34;.join<span class="devsite-syntax-o">(</span>tf.sysconfig.get_link_flags<span class="devsite-syntax-o">(</span><span class="devsite-syntax-k">)</span><span class="devsite-syntax-o">))&#39;)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">)</span>
g++<span class="devsite-syntax-w"> </span>-std<span class="devsite-syntax-o">=</span>c++14<span class="devsite-syntax-w"> </span>-shared<span class="devsite-syntax-w"> </span>zero_out.cc<span class="devsite-syntax-w"> </span>-o<span class="devsite-syntax-w"> </span>zero_out.so<span class="devsite-syntax-w"> </span>-fPIC<span class="devsite-syntax-w"> </span><span class="devsite-syntax-si">${</span><span class="devsite-syntax-nv">TF_CFLAGS</span><span class="devsite-syntax-p">[@]</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-si">${</span><span class="devsite-syntax-nv">TF_LFLAGS</span><span class="devsite-syntax-p">[@]</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-w"> </span>-O2
</code></pre></devsite-code>
<p>On macOS, the additional flag &quot;-undefined dynamic_lookup&quot; is required when
building the <code translate="no" dir="ltr">.so</code> file.</p>

<blockquote>
<p>Note on <code translate="no" dir="ltr">gcc</code> version <code translate="no" dir="ltr">&gt;=5</code>: gcc uses the new C++
<a href="https://gcc.gnu.org/gcc-5/changes.html#libstdcxx">ABI</a> since version <code translate="no" dir="ltr">5</code>.
TensorFlow 2.8 and earlier were built with <code translate="no" dir="ltr">gcc4</code> that uses the older ABI. If
you are using these versions of TensorFlow and are trying to compile your op
library with <code translate="no" dir="ltr">gcc&gt;=5</code>, add <code translate="no" dir="ltr">-D_GLIBCXX_USE_CXX11_ABI=0</code> to the command line to
make the library compatible with the older ABI. TensorFlow 2.9+ packages are
compatible with the newer ABI by default.</p>
</blockquote>

<h3 id="compile_the_op_using_bazel_tensorflow_source_installation" data-text="Compile the op using bazel (TensorFlow source installation)" tabindex="-1">Compile the op using bazel (TensorFlow source installation)</h3>

<p>If you have TensorFlow sources installed, you can make use of TensorFlow&#39;s build
system to compile your op. Place a BUILD file with following Bazel build rule in
the <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/user_ops/"><code translate="no" dir="ltr">tensorflow/core/user_ops</code></a> directory.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">load</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-o">//</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bzl</span>&#34;<span class="devsite-syntax-p">,</span> &#34;<span class="devsite-syntax-n">tf_custom_op_library</span>&#34;<span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-n">tf_custom_op_library</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-n">name</span> <span class="devsite-syntax-o">=</span> &#34;<span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">so</span>&#34;<span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">srcs</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span>&#34;<span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">cc</span>&#34;<span class="devsite-syntax-p">],</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Run the following command to build <code translate="no" dir="ltr">zero_out.so</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Bash"><code translate="no" dir="ltr">$<span class="devsite-syntax-w"> </span>bazel<span class="devsite-syntax-w"> </span>build<span class="devsite-syntax-w"> </span>--config<span class="devsite-syntax-w"> </span>opt<span class="devsite-syntax-w"> </span>//tensorflow/core/user_ops:zero_out.so
</code></pre></devsite-code>
<p>For compiling the <code translate="no" dir="ltr">Example</code> operation, with the CUDA Kernel, you need to use the <code translate="no" dir="ltr">gpu_srcs</code> parameter
of <code translate="no" dir="ltr">tf_custom_op_library</code>. Place a BUILD file with the following Bazel build rule in a new folder
inside the <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/user_ops/"><code translate="no" dir="ltr">tensorflow/core/user_ops</code></a> directory (e.g. &quot;example_gpu&quot;).</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">load</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-o">//</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-p">:</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bzl</span>&#34;<span class="devsite-syntax-p">,</span> &#34;<span class="devsite-syntax-n">tf_custom_op_library</span>&#34;<span class="devsite-syntax-p">)</span>

<span class="devsite-syntax-n">tf_custom_op_library</span><span class="devsite-syntax-p">(</span>
    <span class="devsite-syntax-c1"># kernel_example.cc  kernel_example.cu.cc  kernel_example.h</span>
    <span class="devsite-syntax-n">name</span> <span class="devsite-syntax-o">=</span> &#34;<span class="devsite-syntax-n">kernel_example</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">so</span>&#34;<span class="devsite-syntax-p">,</span>
    <span class="devsite-syntax-n">srcs</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span>&#34;<span class="devsite-syntax-n">kernel_example</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">h</span>&#34;<span class="devsite-syntax-p">,</span> &#34;<span class="devsite-syntax-n">kernel_example</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">cc</span>&#34;<span class="devsite-syntax-p">],</span>
    <span class="devsite-syntax-n">gpu_srcs</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-p">[</span>&#34;<span class="devsite-syntax-n">kernel_example</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">cu</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">cc</span>&#34;<span class="devsite-syntax-p">,</span> &#34;<span class="devsite-syntax-n">kernel_example</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">h</span>&#34;<span class="devsite-syntax-p">],</span>
<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Run the following command to build <code translate="no" dir="ltr">kernel_example.so</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Bash"><code translate="no" dir="ltr">$<span class="devsite-syntax-w"> </span>bazel<span class="devsite-syntax-w"> </span>build<span class="devsite-syntax-w"> </span>--config<span class="devsite-syntax-w"> </span>opt<span class="devsite-syntax-w"> </span>//tensorflow/core/user_ops/example_gpu:kernel_example.so
</code></pre></devsite-code><aside class="note"><strong>Note:</strong><span> As explained above, if you are compiling with gcc&gt;=5 add
<code translate="no" dir="ltr">--cxxopt=&quot;-D_GLIBCXX_USE_CXX11_ABI=0&quot;</code> to the Bazel command line arguments.</span></aside>
<blockquote>
<aside class="note"><strong>Note:</strong><span> Although you can create a shared library (a <code translate="no" dir="ltr">.so</code> file) with the
  standard <code translate="no" dir="ltr">cc_library</code> rule, we strongly recommend that you use the
  <code translate="no" dir="ltr">tf_custom_op_library</code> macro. It adds some required dependencies, and
  performs checks to ensure that the shared library is compatible with
  TensorFlow&#39;s plugin loading mechanism.</span></aside></blockquote>

<h2 id="use_the_op_in_python" data-text="Use the op in Python" tabindex="-1">Use the op in Python</h2>

<p>TensorFlow Python API provides the
<a href="https://www.tensorflow.org/api_docs/python/tf/load_op_library"><code translate="no" dir="ltr">tf.load_op_library</code></a> function to
load the dynamic library and register the op with the TensorFlow
framework. <code translate="no" dir="ltr">load_op_library</code> returns a Python module that contains the Python
wrappers for the op and the kernel. Thus, once you have built the op, you can
do the following to run it from Python:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-nn">tensorflow</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-nn">tf</span>
<span class="devsite-syntax-n">zero_out_module</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">load_op_library</span><span class="devsite-syntax-p">(</span>&#39;<span class="devsite-syntax-o">./</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">so</span>&#39;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-nb">print</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">zero_out_module</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-p">([[</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">2</span><span class="devsite-syntax-p">],</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-mi">3</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">4</span><span class="devsite-syntax-p">]])</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">numpy</span><span class="devsite-syntax-p">())</span>

<span class="devsite-syntax-c1"># Prints</span>
<span class="devsite-syntax-n">array</span><span class="devsite-syntax-p">([[</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">],</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">]],</span> <span class="devsite-syntax-n">dtype</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Keep in mind, the generated function will be given a snake_case name (to comply
with <a href="https://www.python.org/dev/peps/pep-0008/">PEP8</a>). So, if your op is
named <code translate="no" dir="ltr">ZeroOut</code> in the C++ files, the python function will be called <code translate="no" dir="ltr">zero_out</code>.</p>

<p>To make the op available as a regular function <code translate="no" dir="ltr">import</code>-able from a Python
module, it maybe useful to have the <code translate="no" dir="ltr">load_op_library</code> call in a Python source
file as follows:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-nn">tensorflow</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-nn">tf</span>

<span class="devsite-syntax-n">zero_out_module</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">load_op_library</span><span class="devsite-syntax-p">(</span>&#39;<span class="devsite-syntax-o">./</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">so</span>&#39;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-n">zero_out</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">zero_out_module</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">zero_out</span>
</code></pre></devsite-code>
<h2 id="verify_that_the_op_works" data-text="Verify that the op works" tabindex="-1">Verify that the op works</h2>

<p>A good way to verify that you&#39;ve successfully implemented your op is to write a
test for it. Create the file
<code translate="no" dir="ltr">zero_out_op_test.py</code> with the contents:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-nn">tensorflow</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-nn">tf</span>

<span class="devsite-syntax-k">class</span> <span class="devsite-syntax-nc">ZeroOutTest</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">test</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">TestCase</span><span class="devsite-syntax-p">):</span>
  <span class="devsite-syntax-k">def</span> <span class="devsite-syntax-nf">testZeroOut</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-bp">self</span><span class="devsite-syntax-p">):</span>
    <span class="devsite-syntax-n">zero_out_module</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">load_op_library</span><span class="devsite-syntax-p">(</span>&#39;<span class="devsite-syntax-o">./</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">so</span>&#39;<span class="devsite-syntax-p">)</span>
    <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">test_session</span><span class="devsite-syntax-p">():</span>
      <span class="devsite-syntax-n">result</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">zero_out_module</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-p">([</span><span class="devsite-syntax-mi">5</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">4</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">3</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">2</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">])</span>
      <span class="devsite-syntax-bp">self</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">assertAllEqual</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">result</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">eval</span><span class="devsite-syntax-p">(),</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-mi">5</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">])</span>

<span class="devsite-syntax-k">if</span> <span class="devsite-syntax-vm">__name__</span> <span class="devsite-syntax-o">==</span> &#34;<span class="devsite-syntax-n">__main__</span>&#34;<span class="devsite-syntax-p">:</span>
  <span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">test</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">main</span><span class="devsite-syntax-p">()</span>
</code></pre></devsite-code>
<p>Then run your test (assuming you have tensorflow installed):</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Bash"><code translate="no" dir="ltr">$<span class="devsite-syntax-w"> </span>python<span class="devsite-syntax-w"> </span>zero_out_op_test.py
</code></pre></devsite-code>
<h2 id="build_advanced_features_into_your_op" data-text="Build advanced features into your op" tabindex="-1">Build advanced features into your op</h2>

<p>Now that you know how to build a basic (and somewhat restricted) op and
implementation, we&#39;ll look at some of the more complicated things you will
typically need to build into your op. This includes:</p>

<ul>
<li><a href="#conditional_checks_and_validation">Conditional checks and validation</a></li>
<li><a href="#op_registration">Op registration</a>
<ul>
<li><a href="#attrs">Attrs</a></li>
<li><a href="#attr_types">Attr types</a></li>
<li><a href="#polymorphism">Polymorphism</a></li>
<li><a href="#inputs_and_outputs">Inputs and outputs</a></li>
<li><a href="#backwards_compatibility">Backwards compatibility</a></li>
</ul></li>
<li><a href="#gpu_support">GPU support</a>
<ul>
<li><a href="#compiling_the_kernel_for_the_gpu_device">Compiling the kernel for the GPU device</a></li>
</ul></li>
<li><a href="#implement_the_gradient_in_python">Implement the gradient in Python</a></li>
<li><a href="#shape_functions_in_c">Shape functions in C++</a></li>
</ul>

<h3 id="conditional_checks_and_validation" data-text="Conditional checks and validation" tabindex="-1">Conditional checks and validation</h3>

<p>The example above assumed that the op applied to a tensor of any shape.  What
if it only applied to vectors?  That means adding a check to the above OpKernel
implementation.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Grab the input tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Tensor</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">TensorShapeUtils</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">IsVector</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">()),</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">errors</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InvalidArgument</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">expects</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">a</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">D</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">vector</span><span class="devsite-syntax-p">.&#34;));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// ...</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<p>This asserts that the input is a vector, and returns having set the
<code translate="no" dir="ltr">InvalidArgument</code> status if it isn&#39;t.  The
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/errors.h"><code translate="no" dir="ltr">OP_REQUIRES</code> macro</a> takes three arguments:</p>

<ul>
<li>The <code translate="no" dir="ltr">context</code>, which can either be an <code translate="no" dir="ltr">OpKernelContext</code> or
<code translate="no" dir="ltr">OpKernelConstruction</code> pointer (see
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/op_kernel.h"><code translate="no" dir="ltr">tensorflow/core/framework/op_kernel.h</code></a>),
for its <code translate="no" dir="ltr">SetStatus()</code> method.</li>
<li>The condition.  For example, there are functions for validating the shape
of a tensor in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/tensor_shape.h"><code translate="no" dir="ltr">tensorflow/core/framework/tensor_shape.h</code></a></li>
<li>The error itself, which is represented by a <code translate="no" dir="ltr">Status</code> object, see
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/status.h"><code translate="no" dir="ltr">tensorflow/core/platform/status.h</code></a>. A
<code translate="no" dir="ltr">Status</code> has both a type (frequently <code translate="no" dir="ltr">InvalidArgument</code>, but see the list of
types) and a message.  Functions for constructing an error may be found in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/errors.h"><code translate="no" dir="ltr">tensorflow/core/platform/errors.h</code></a>.</li>
</ul>

<p>Alternatively, if you want to test whether a <code translate="no" dir="ltr">Status</code> object returned from some
function is an error, and if so return it, use
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/platform/errors.h"><code translate="no" dir="ltr">OP_REQUIRES_OK</code></a>.  Both of these macros return from the
function on error.</p>

<h3 id="op_registration" data-text="Op registration" tabindex="-1">Op registration</h3>

<h4 id="attrs" data-text="Attrs" tabindex="-1">Attrs</h4>

<p>Ops can have attrs, whose values are set when the op is added to a graph. These
are used to configure the op, and their values can be accessed both within the
kernel implementation and in the types of inputs and outputs in the op
registration. Prefer using an input instead of an attr when possible, since
inputs are more flexible. This is because attrs are constants and must be
defined at graph construction time. In contrast, inputs are Tensors whose
values can be dynamic; that is, inputs can change every step, be set using a
feed, etc. Attrs are used for things that can&#39;t be done with inputs: any
configuration that affects the signature (number or type of inputs or outputs)
or that can&#39;t change from step-to-step.</p>

<p>You define an attr when you register the op, by specifying its name and type
using the <code translate="no" dir="ltr">Attr</code> method, which expects a spec of the form:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="ActionScript 3"><code translate="no" dir="ltr">&lt;<span class="devsite-syntax-n">name</span>&gt;<span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-n">attr</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">expr</span>&gt;
</code></pre></devsite-code>
<p>where <code translate="no" dir="ltr">&lt;name&gt;</code> begins with a letter and can be composed of alphanumeric
characters and underscores, and <code translate="no" dir="ltr">&lt;attr-type-expr&gt;</code> is a type expression of the
form <a href="#attr_types">described below</a>.</p>

<p>For example, if you&#39;d like the <code translate="no" dir="ltr">ZeroOut</code> op to preserve a user-specified index,
instead of only the 0th element, you can register the op like so:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">preserve_index</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>(Note that the set of <a href="#attr_types">attribute types</a> is different from the
<a href="https://www.tensorflow.org/api_docs/python/tf/dtypes/DType"><code translate="no" dir="ltr">tf.DType</code></a> used for inputs and outputs.)</p>

<p>Your kernel can then access this attr in its constructor via the <code translate="no" dir="ltr">context</code>
parameter:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ZeroOutOp</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-o">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-k">explicit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZeroOutOp</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelConstruction</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Get the index of the value to preserve</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES_OK</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                   </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">GetAttr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">preserve_index</span>&#34;<span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span>&amp;<span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Check that preserve_index is positive</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">errors</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InvalidArgument</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">Need</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">preserve_index</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">got</span><span class="devsite-syntax-w"> </span>&#34;<span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                                        </span><span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// ...</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">private</span><span class="devsite-syntax-o">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-p">};</span>
</code></pre></devsite-code>
<p>which can then be used in the <code translate="no" dir="ltr">Compute</code> method:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nf">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// ...</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// We&#39;re using saved attr to validate potentially dynamic input</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// So we check that preserve_index is in range</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">dimension</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">                </span><span class="devsite-syntax-n">errors</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InvalidArgument</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">preserve_index</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">of</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">range</span>&#34;<span class="devsite-syntax-p">));</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Set all the elements of the output tensor to 0</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">++</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Preserve the requested input value</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">preserve_index_</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
</code></pre></devsite-code>
<h4 id="attr_types" data-text="Attr types" tabindex="-1">Attr types</h4>

<p>The following types are supported in an attr:</p>

<ul>
<li><code translate="no" dir="ltr">string</code>: Any sequence of bytes (not required to be UTF8).</li>
<li><code translate="no" dir="ltr">int</code>: A signed integer.</li>
<li><code translate="no" dir="ltr">float</code>: A floating point number.</li>
<li><code translate="no" dir="ltr">bool</code>: True or false.</li>
<li><code translate="no" dir="ltr">type</code>: One of the (non-ref) values of <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/types.cc"><code translate="no" dir="ltr">DataType</code></a>.</li>
<li><code translate="no" dir="ltr">shape</code>: A <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/tensor_shape.proto"><code translate="no" dir="ltr">TensorShapeProto</code></a>.</li>
<li><code translate="no" dir="ltr">list(&lt;type&gt;)</code>: A list of <code translate="no" dir="ltr">&lt;type&gt;</code>, where <code translate="no" dir="ltr">&lt;type&gt;</code> is one of the above types.
Note that <code translate="no" dir="ltr">list(list(&lt;type&gt;))</code> is invalid.</li>
</ul>

<p>See also: <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/op_def_builder.cc"><code translate="no" dir="ltr">op_def_builder.cc:FinalizeAttr</code></a> for a definitive list.</p>

<h5 id="default_values_and_constraints" data-text="Default values and constraints" tabindex="-1">Default values and constraints</h5>

<p>Attrs may have default values, and some types of attrs can have constraints. To
define an attr with constraints, you can use the following <code translate="no" dir="ltr">&lt;attr-type-expr&gt;</code>s:</p>

<p><code translate="no" dir="ltr">{&#39;&lt;string1&gt;&#39;, &#39;&lt;string2&gt;&#39;}</code>: The value must be a string that has either the
value <code translate="no" dir="ltr">&lt;string1&gt;</code> or <code translate="no" dir="ltr">&lt;string2&gt;</code>. The name of the type, <code translate="no" dir="ltr">string</code>, is implied
when you use this syntax. This emulates an enum:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">EnumExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">e</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>&#39;<span class="devsite-syntax-n">apple</span>&#39;<span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span>&#39;<span class="devsite-syntax-n">orange</span>&#39;<span class="devsite-syntax-p">}&#34;);</span>
</code></pre></devsite-code>
<p><code translate="no" dir="ltr">{&lt;type1&gt;, &lt;type2&gt;}</code>: The value is of type <code translate="no" dir="ltr">type</code>, and must be one of <code translate="no" dir="ltr">&lt;type1&gt;</code>
or <code translate="no" dir="ltr">&lt;type2&gt;</code>, where <code translate="no" dir="ltr">&lt;type1&gt;</code> and <code translate="no" dir="ltr">&lt;type2&gt;</code> are supported <code translate="no" dir="ltr">tf.DType</code>. You don&#39;t
specify that the type of the attr is <code translate="no" dir="ltr">type</code>. This is implied when you have a
list of types in <code translate="no" dir="ltr">{...}</code>. For example, in this case the attr <code translate="no" dir="ltr">t</code> is a type that
must be an <code translate="no" dir="ltr">int32</code>, a <code translate="no" dir="ltr">float</code>, or a <code translate="no" dir="ltr">bool</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">RestrictedTypeExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">bool</span><span class="devsite-syntax-p">}&#34;);</span>
</code></pre></devsite-code>
<p>There are shortcuts for common type constraints:</p>

<ul>
<li><code translate="no" dir="ltr">numbertype</code>: Type <code translate="no" dir="ltr">type</code> restricted to the numeric (non-string and
non-bool) types.</li>
<li><code translate="no" dir="ltr">realnumbertype</code>: Like <code translate="no" dir="ltr">numbertype</code> without complex types.</li>
<li><code translate="no" dir="ltr">quantizedtype</code>: Like <code translate="no" dir="ltr">numbertype</code> but just the quantized number types.</li>
</ul>

<p>The specific lists of types allowed by these are defined by the functions (like
<code translate="no" dir="ltr">NumberTypes()</code>) in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/types.h"><code translate="no" dir="ltr">tensorflow/core/framework/types.h</code></a>.
In this example the attr <code translate="no" dir="ltr">t</code> must be one of the numeric types:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">NumberType</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">numbertype</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>For this op:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">number_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">)</span>  <span class="devsite-syntax-c1"># Valid</span>
<span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">number_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bool</span><span class="devsite-syntax-p">)</span>   <span class="devsite-syntax-c1"># Invalid</span>
</code></pre></devsite-code>
<p>Lists can be combined with other lists and single types. The following op allows
attr <code translate="no" dir="ltr">t</code> to be any of the numeric types, or the bool type:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">NumberOrBooleanType</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">numbertype</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">bool</span><span class="devsite-syntax-p">}&#34;);</span>
</code></pre></devsite-code>
<p>For this op:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">number_or_boolean_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">)</span>  <span class="devsite-syntax-c1"># Valid</span>
<span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">number_or_boolean_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">bool</span><span class="devsite-syntax-p">)</span>   <span class="devsite-syntax-c1"># Valid</span>
<span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">number_or_boolean_type</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">t</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">string</span><span class="devsite-syntax-p">)</span> <span class="devsite-syntax-c1"># Invalid</span>
</code></pre></devsite-code>
<p><code translate="no" dir="ltr">int &gt;= &lt;n&gt;</code>: The value must be an int whose value is greater than or equal to
<code translate="no" dir="ltr">&lt;n&gt;</code>, where <code translate="no" dir="ltr">&lt;n&gt;</code> is a natural number. For example, the following op
registration specifies that the attr <code translate="no" dir="ltr">a</code> must have a value that is at least <code translate="no" dir="ltr">2</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">MinIntExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">a</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">2</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p><code translate="no" dir="ltr">list(&lt;type&gt;) &gt;= &lt;n&gt;</code>: A list of type <code translate="no" dir="ltr">&lt;type&gt;</code> whose length is greater than or
equal to <code translate="no" dir="ltr">&lt;n&gt;</code>. For example, the following op registration specifies that the
attr <code translate="no" dir="ltr">a</code> is a list of types (either <code translate="no" dir="ltr">int32</code> or <code translate="no" dir="ltr">float</code>), and that there must be
at least 3 of them:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">TypeListExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">a</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">({</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">})</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">3</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>To set a default value for an attr (making it optional in the generated code),
add <code translate="no" dir="ltr">= &lt;default&gt;</code> to the end, as in:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">AttrDefaultExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>Additionally, both a constraint and a default value can be specified:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">AttrConstraintAndDefaultExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>The supported syntax of the default value is what would be used in the proto
representation of the resulting GraphDef definition.</p>

<p>Here are examples for how to specify a default for all types:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">AttrDefaultExampleForAllTypes</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">s</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">string</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span>&#39;<span class="devsite-syntax-n">foo</span>&#39;&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">f</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mf">1.0</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">b</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">bool</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">true</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ty</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DT_INT32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">sh</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dim</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dim</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}&#34;)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">te</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">dtype</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DT_INT32</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int_val</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">5</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">}&#34;)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">l_empty</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">[]&#34;)</span>
<span class="devsite-syntax-w">   </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">l_int</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">3</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">5</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">7</span><span class="devsite-syntax-p">]&#34;);</span>
</code></pre></devsite-code>
<p>Note in particular that the values of type <code translate="no" dir="ltr">type</code>
use <a href="https://www.tensorflow.org/api_docs/python/tf/dtypes/DType"><code translate="no" dir="ltr">tf.DType</code></a>.</p>

<h4 id="polymorphism" data-text="Polymorphism" tabindex="-1">Polymorphism</h4>

<h5 id="type_polymorphism" data-text="Type polymorphism" tabindex="-1">Type polymorphism</h5>

<p>For ops that can take different types as input or produce different output
types, you can specify <a href="#attrs">an attr</a> in
<a href="#inputs_and_outputs">an input or output type</a> in the op registration.  Typically
you would then register an <code translate="no" dir="ltr">OpKernel</code> for each supported type.</p>

<p>For instance, if you&#39;d like the <code translate="no" dir="ltr">ZeroOut</code> op to work on <code translate="no" dir="ltr">float</code>s
in addition to <code translate="no" dir="ltr">int32</code>s, your op registration might look like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">}&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>Your op registration now specifies that the input&#39;s type must be <code translate="no" dir="ltr">float</code>, or
<code translate="no" dir="ltr">int32</code>, and that its output will be the same type, since both have type <code translate="no" dir="ltr">T</code>.</p>

<h6 id="naming" data-text="Naming" tabindex="-1">Naming</h6>

<p>Inputs, outputs, and attrs generally should be given snake_case names. The one
exception is attrs that are used as the type of an input or in the type of an
output. Those attrs can be inferred when the op is added to the graph and so
don&#39;t appear in the op&#39;s function. For example, this last definition of ZeroOut
will generate a Python function that looks like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-k">def</span> <span class="devsite-syntax-nf">zero_out</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">):</span>
  &#34;&#34;&#34;<span class="devsite-syntax-o">...</span>
  <span class="devsite-syntax-n">Args</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-n">Must</span> <span class="devsite-syntax-n">be</span> <span class="devsite-syntax-n">one</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">following</span> <span class="devsite-syntax-n">types</span><span class="devsite-syntax-p">:</span>
        <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">float32</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-n">name</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">operation</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">optional</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span>

  <span class="devsite-syntax-n">Returns</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span> <span class="devsite-syntax-n">Has</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">same</span> <span class="devsite-syntax-nb">type</span> <span class="devsite-syntax-k">as</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
  &#34;&#34;&#34;
</code></pre></devsite-code>
<p>If <code translate="no" dir="ltr">to_zero</code> is passed an <code translate="no" dir="ltr">int32</code> tensor, then <code translate="no" dir="ltr">T</code> is automatically set to
<code translate="no" dir="ltr">int32</code> (well, actually <code translate="no" dir="ltr">DT_INT32</code>). Those inferred attrs are given Capitalized
or CamelCase names.</p>

<p>Compare this with an op that has a type attr that determines the output type:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">StringToNumber</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">string_tensor</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">string</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">output</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">out_type</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out_type</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DT_FLOAT</span>&#34;<span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Doc</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">R&#34;doc</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-n">Converts</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">each</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">string</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">in</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">to</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">the</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">specified</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">numeric</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-p">.</span>
<span class="devsite-syntax-p">)</span><span class="devsite-syntax-n">doc</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>In this case, the user has to specify the output type, as in the generated
Python:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-k">def</span> <span class="devsite-syntax-nf">string_to_number</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">string_tensor</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">out_type</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">name</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-kc">None</span><span class="devsite-syntax-p">):</span>
  &#34;&#34;&#34;<span class="devsite-syntax-n">Converts</span> <span class="devsite-syntax-n">each</span> <span class="devsite-syntax-n">string</span> <span class="devsite-syntax-ow">in</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-nb">input</span> <span class="devsite-syntax-n">Tensor</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">specified</span> <span class="devsite-syntax-n">numeric</span> <span class="devsite-syntax-nb">type</span><span class="devsite-syntax-o">.</span>

  <span class="devsite-syntax-n">Args</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">string_tensor</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-err">`</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-nb">type</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">string</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-n">out_type</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">An</span> <span class="devsite-syntax-n">optional</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">DType</span><span class="devsite-syntax-err">`</span> <span class="devsite-syntax-n">from</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">float32</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
      <span class="devsite-syntax-n">Defaults</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">tf</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">float32</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-n">name</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-n">name</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">operation</span> <span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">optional</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-o">.</span>

  <span class="devsite-syntax-n">Returns</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">A</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-err">`</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-nb">type</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">out_type</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
  &#34;&#34;&#34;
</code></pre></devsite-code>
<h6 id="type_polymorphism_example" data-text="Type polymorphism example" tabindex="-1">Type polymorphism example</h6>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op_kernel.h</span>&#34;

<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ZeroOutInt32Op</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-c1">// as before</span>
<span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ZeroOutFloatOp</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-o">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-k">explicit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZeroOutFloatOp</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelConstruction</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{}</span>

<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Grab the input tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Tensor</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">auto</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">flat&lt;float&gt;</span><span class="devsite-syntax-p">();</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Create an output tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">NULL</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES_OK</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                   </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">allocate_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">(),</span><span class="devsite-syntax-w"> </span>&amp;<span class="devsite-syntax-n">output</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">auto</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">flat&lt;float&gt;</span><span class="devsite-syntax-p">();</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Set all the elements of the output tensor to 0</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">++</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Preserve the first input value</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> &gt; </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-c1">// Note that TypeConstraint&lt;int32&gt;(&#34;T&#34;) means that attr &#34;T&#34; (defined</span>
<span class="devsite-syntax-c1">// in the op registration above) must be &#34;int32&#34; to use this template</span>
<span class="devsite-syntax-c1">// instantiation.</span>
<span class="devsite-syntax-n">REGISTER_KERNEL_BUILDER</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Name</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Device</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">DEVICE_CPU</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">TypeConstraint&lt;int32&gt;</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">ZeroOutInt32Op</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_KERNEL_BUILDER</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Name</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Device</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">DEVICE_CPU</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">TypeConstraint&lt;float&gt;</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">ZeroOutFloatOp</span><span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>To preserve <a href="#backwards_compatibility">backwards compatibility</a>, you should
specify a <a href="#default_values_and_constraints">default value</a> when adding an attr
to an existing op:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">}</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DT_INT32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Let&#39;s say you wanted to add more types, say <code translate="no" dir="ltr">double</code>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">double</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">}&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>Instead of writing another <code translate="no" dir="ltr">OpKernel</code> with redundant code as above, often you
will be able to use a C++ template instead.  You will still have one kernel
registration (<code translate="no" dir="ltr">REGISTER_KERNEL_BUILDER</code> call) per overload.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ZeroOutOp</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-o">:</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-k">explicit</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">ZeroOutOp</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelConstruction</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{}</span>

<span class="devsite-syntax-w">  </span><span class="devsite-syntax-kt">void</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Compute</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">OpKernelContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">override</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Grab the input tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Tensor</span>&amp;<span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">auto</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">flat&lt;T&gt;</span><span class="devsite-syntax-p">();</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Create an output tensor</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Tensor</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nb">NULL</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">OP_REQUIRES_OK</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-p">,</span>
<span class="devsite-syntax-w">                   </span><span class="devsite-syntax-n">context</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">allocate_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input_tensor</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">(),</span><span class="devsite-syntax-w"> </span>&amp;<span class="devsite-syntax-n">output</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">auto</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">flat&lt;T&gt;</span><span class="devsite-syntax-p">();</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Set all the elements of the output tensor to 0</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">const</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">size</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-o">++</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">}</span>

<span class="devsite-syntax-w">    </span><span class="devsite-syntax-c1">// Preserve the first input value</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">if</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> &gt; </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output_flat</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-c1">// Note that TypeConstraint&lt;int32&gt;(&#34;T&#34;) means that attr &#34;T&#34; (defined</span>
<span class="devsite-syntax-c1">// in the op registration above) must be &#34;int32&#34; to use this template</span>
<span class="devsite-syntax-c1">// instantiation.</span>
<span class="devsite-syntax-n">REGISTER_KERNEL_BUILDER</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Name</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Device</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">DEVICE_CPU</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">TypeConstraint&lt;int32&gt;</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">ZeroOutOp&lt;int32&gt;</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_KERNEL_BUILDER</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Name</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Device</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">DEVICE_CPU</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">TypeConstraint&lt;float&gt;</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">ZeroOutOp&lt;float&gt;</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_KERNEL_BUILDER</span><span class="devsite-syntax-p">(</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">Name</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Device</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">DEVICE_CPU</span><span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">TypeConstraint&lt;double&gt;</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">),</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">ZeroOutOp&lt;double&gt;</span><span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>If you have more than a couple overloads, you can put the registration in a
macro.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op_kernel.h</span>&#34;

<span class="devsite-syntax-cp">#define REGISTER_KERNEL(type)                                       \</span>
<span class="devsite-syntax-cp">  REGISTER_KERNEL_BUILDER(                                          \</span>
<span class="devsite-syntax-cp">      Name(&#34;ZeroOut&#34;).Device(DEVICE_CPU).TypeConstraint&lt;type&gt;(&#34;T&#34;), \</span>
<span class="devsite-syntax-cp">      ZeroOutOp&lt;type&gt;)</span>

<span class="devsite-syntax-n">REGISTER_KERNEL</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_KERNEL</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-n">REGISTER_KERNEL</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">double</span><span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-cp">#undef REGISTER_KERNEL</span>
</code></pre></devsite-code>
<p>Depending on the list of types you are registering the kernel for, you may be
able to use a macro provided by
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/register_types.h"><code translate="no" dir="ltr">tensorflow/core/framework/register_types.h</code></a>:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/op_kernel.h</span>&#34;
<span class="devsite-syntax-cp">#include &#34;tensorflow/core/framework/register_types.h</span>&#34;

<span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">realnumbertype</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-k">template</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-k">typename</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">T</span>&gt;
<span class="devsite-syntax-k">class</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-nc">ZeroOutOp</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-k">public</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">OpKernel</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">...</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">};</span>

<span class="devsite-syntax-cp">#define REGISTER_KERNEL(type)                                       \</span>
<span class="devsite-syntax-cp">  REGISTER_KERNEL_BUILDER(                                          \</span>
<span class="devsite-syntax-cp">      Name(&#34;ZeroOut&#34;).Device(DEVICE_CPU).TypeConstraint&lt;type&gt;(&#34;T&#34;), \</span>
<span class="devsite-syntax-cp">      ZeroOutOp&lt;type&gt;)</span>

<span class="devsite-syntax-n">TF_CALL_REAL_NUMBER_TYPES</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">REGISTER_KERNEL</span><span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-cp">#undef REGISTER_KERNEL</span>
</code></pre></devsite-code>
<h5 id="list_inputs_and_outputs" data-text="List inputs and outputs" tabindex="-1">List inputs and outputs</h5>

<p>In addition to being able to accept or produce different types, ops can consume
or produce a variable number of tensors.</p>

<p>In the next example, the attr <code translate="no" dir="ltr">T</code> holds a <em>list</em> of types, and is used as the
type of both the input <code translate="no" dir="ltr">in</code> and the output <code translate="no" dir="ltr">out</code>.  The input and output are
lists of tensors of that type (and the number and types of tensors in the output
are the same as the input, since both have type <code translate="no" dir="ltr">T</code>).</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">PolymorphicListExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-p">)&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>You can also place restrictions on what types can be specified in the list. In
this next case, the input is a list of <code translate="no" dir="ltr">float</code> and <code translate="no" dir="ltr">double</code> tensors. The op
accepts, for example, input types <code translate="no" dir="ltr">(float, double, float)</code> and in that case the
output type would also be <code translate="no" dir="ltr">(float, double, float)</code>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ListTypeRestrictionExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">({</span><span class="devsite-syntax-kt">float</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">double</span><span class="devsite-syntax-p">})&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>If you want all the tensors in a list to be of the same type, you might do
something like:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">IntListInputExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">N</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>This accepts a list of <code translate="no" dir="ltr">int32</code> tensors, and uses an <code translate="no" dir="ltr">int</code> attr <code translate="no" dir="ltr">N</code> to
specify the length of the list.</p>

<p>This can be made <a href="#type_polymorphism">type polymorphic</a> as well.  In the next
example, the input is a list of tensors (with length <code translate="no" dir="ltr">&quot;N&quot;</code>) of the same (but
unspecified) type (<code translate="no" dir="ltr">&quot;T&quot;</code>), and the output is a single tensor of matching type:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">SameListInputExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">N</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">type</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>By default, tensor lists have a minimum length of 1. You can change that default
using
<a href="#default_values_and_constraints">a <code translate="no" dir="ltr">&quot;&gt;=&quot;</code> constraint on the corresponding attr</a>.
In this next example, the input is a list of at least 2 <code translate="no" dir="ltr">int32</code> tensors:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">MinLengthIntListExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">N</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">2</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">N</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>The same syntax works with <code translate="no" dir="ltr">&quot;list(type)&quot;</code> attrs:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">MinimumLengthPolymorphicListExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span>&gt;<span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">3</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<h4 id="inputs_and_outputs" data-text="Inputs and outputs" tabindex="-1">Inputs and outputs</h4>

<p>To summarize the above, an op registration can have multiple inputs and outputs:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">MultipleInsAndOuts</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">y</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">z</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">a</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">string</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">b</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>Each input or output spec is of the form:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="ActionScript 3"><code translate="no" dir="ltr">&lt;<span class="devsite-syntax-n">name</span>&gt;<span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span>&lt;<span class="devsite-syntax-n">io</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-n">expr</span>&gt;
</code></pre></devsite-code>
<p>where <code translate="no" dir="ltr">&lt;name&gt;</code> begins with a letter and can be composed of alphanumeric
characters and underscores. <code translate="no" dir="ltr">&lt;io-type-expr&gt;</code> is one of the following type
expressions:</p>

<ul>
<li><p><code translate="no" dir="ltr">&lt;type&gt;</code>, where <code translate="no" dir="ltr">&lt;type&gt;</code> is a supported input type (e.g. <code translate="no" dir="ltr">float</code>, <code translate="no" dir="ltr">int32</code>,
<code translate="no" dir="ltr">string</code>). This specifies a single tensor of the given type.</p>

<p>See
<a href="https://www.tensorflow.org/api_docs/python/tf/dtypes/DType"><code translate="no" dir="ltr">tf.DType</code></a>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">BuiltInTypesExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">integers</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">complex_numbers</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">complex64</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code></li>
<li><p><code translate="no" dir="ltr">&lt;attr-type&gt;</code>, where <code translate="no" dir="ltr">&lt;attr-type&gt;</code> is the name of an <a href="#attrs">Attr</a> with type
<code translate="no" dir="ltr">type</code> or <code translate="no" dir="ltr">list(type)</code> (with a possible type restriction). This syntax allows
for <a href="#polymorphism">polymorphic ops</a>.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">PolymorphicSingleInput</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">type</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">RestrictedPolymorphicSingleInput</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int64</span><span class="devsite-syntax-p">}&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>Referencing an attr of type <code translate="no" dir="ltr">list(type)</code> allows you to accept a sequence of
tensors.</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ArbitraryTensorSequenceExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">type</span><span class="devsite-syntax-p">)&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>

<span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">RestrictedTensorSequenceExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">list</span><span class="devsite-syntax-p">({</span><span class="devsite-syntax-n">int32</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int64</span><span class="devsite-syntax-p">})&#34;)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>Note that the number and types of tensors in the output <code translate="no" dir="ltr">out</code> is the same as
in the input <code translate="no" dir="ltr">in</code>, since both are of type <code translate="no" dir="ltr">T</code>.</p></li>
<li><p>For a sequence of tensors with the same type: <code translate="no" dir="ltr">&lt;number&gt; * &lt;type&gt;</code>, where
<code translate="no" dir="ltr">&lt;number&gt;</code> is the name of an <a href="#attrs">Attr</a> with type <code translate="no" dir="ltr">int</code>.  The <code translate="no" dir="ltr">&lt;type&gt;</code> can
either be a <a href="https://www.tensorflow.org/api_docs/python/tf/dtypes/DType"><code translate="no" dir="ltr">tf.DType</code></a>,
or the name of an attr with type <code translate="no" dir="ltr">type</code>.  As an example of the first, this
op accepts a list of <code translate="no" dir="ltr">int32</code> tensors:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">Int32SequenceExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">NumTensors</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NumTensors</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code>
<p>Whereas this op accepts a list of tensors of any type, as long as they are all
the same:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">SameTypeSequenceExample</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">NumTensors</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">int</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">type</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">NumTensors</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
</code></pre></devsite-code></li>
<li><p>For a reference to a tensor: <code translate="no" dir="ltr">Ref(&lt;type&gt;)</code>, where <code translate="no" dir="ltr">&lt;type&gt;</code> is one of the
previous types.</p></li>
</ul>

<p>Any attr used in the type of an input will be inferred. By convention those
inferred attrs use capital names (like <code translate="no" dir="ltr">T</code> or <code translate="no" dir="ltr">N</code>). Otherwise inputs, outputs,
and attrs have names like function parameters (e.g. <code translate="no" dir="ltr">num_outputs</code>). For more
details, see the <a href="#naming">earlier section on naming</a>.</p>

<p>For more details, see
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/op_def_builder.h"><code translate="no" dir="ltr">tensorflow/core/framework/op_def_builder.h</code></a>.</p>

<h4 id="backwards_compatibility" data-text="Backwards compatibility" tabindex="-1">Backwards compatibility</h4>

<p>Let&#39;s assume you have written a nice, custom op and shared it with others, so
you have happy customers using your operation.  However, you&#39;d like to make
changes to the op in some way.</p>

<p>In general, changes to existing, checked-in specifications must be
backwards-compatible: changing the specification of an op must not break prior
serialized <code translate="no" dir="ltr">GraphDef</code> protocol buffers constructed from older specifications.
The details of <code translate="no" dir="ltr">GraphDef</code> compatibility are
<a href="https://www.tensorflow.org/guide/versions#compatibility_of_graphs_and_checkpoints">described here</a>.</p>

<p>There are several ways to preserve backwards-compatibility.</p>

<ol>
<li><p>Any new attrs added to an operation must have default values defined, and
with that default value the op must have the original behavior. To change an
operation from not polymorphic to polymorphic, you <em>must</em> give a default
value to the new type attr to preserve the original signature by default.
For example, if your operation was:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">MyGeneralUnaryOp</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-kt">float</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>you can make it polymorphic in a backwards-compatible way using:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">MyGeneralUnaryOp</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">in</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">out</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">T</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Attr</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">T</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">numerictype</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">DT_FLOAT</span>&#34;<span class="devsite-syntax-p">);</span>
</code></pre></devsite-code></li>
<li><p>You can safely make a constraint on an attr less restrictive. For example,
you can change from <code translate="no" dir="ltr">{int32, int64}</code> to <code translate="no" dir="ltr">{int32, int64, float}</code> or <code translate="no" dir="ltr">type</code>.
Or you may change from <code translate="no" dir="ltr">{&quot;apple&quot;, &quot;orange&quot;}</code> to <code translate="no" dir="ltr">{&quot;apple&quot;, &quot;banana&quot;,
&quot;orange&quot;}</code> or <code translate="no" dir="ltr">string</code>.</p></li>
<li><p>You can change single inputs / outputs into list inputs / outputs, as long
as the default for the list type matches the old signature.</p></li>
<li><p>You can add a new list input / output, if it defaults to empty.</p></li>
<li><p>Namespace any new ops you create, by prefixing the op names with something
unique to your project. This avoids having your op colliding with any ops
that might be included in future versions of TensorFlow.</p></li>
<li><p>Plan ahead! Try to anticipate future uses for the op. Some signature changes
can&#39;t be done in a compatible way (for example, making a list of the same
type into a list of varying types).</p></li>
</ol>

<p>The full list of safe and unsafe changes can be found in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/op_compatibility_test.cc"><code translate="no" dir="ltr">tensorflow/core/framework/op_compatibility_test.cc</code></a>.
If you cannot make your change to an operation backwards compatible, then create
a new operation with a new name with the new semantics.</p>

<p>Also note that while these changes can maintain <code translate="no" dir="ltr">GraphDef</code> compatibility, the
generated Python code may change in a way that isn&#39;t compatible with old
callers.  The Python API may be kept compatible by careful changes in a
hand-written Python wrapper, by keeping the old signature except possibly adding
new optional arguments to the end.  Generally incompatible changes may only be
made when TensorFlow changes major versions, and must conform to the
<a href="https://www.tensorflow.org/guide/versions#compatibility_of_graphs_and_checkpoints"><code translate="no" dir="ltr">GraphDef</code> version semantics</a>.</p>

<h3 id="gpu_support" data-text="GPU support" tabindex="-1">GPU support</h3>

<p>You can implement different OpKernels and register one for CPU and another for
GPU, just like you can <a href="#polymorphism">register kernels for different types</a>.
There are several examples of kernels with GPU support in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/"><code translate="no" dir="ltr">tensorflow/core/kernels/</code></a>.
Notice some kernels have a CPU version in a <code translate="no" dir="ltr">.cc</code> file, a GPU version in a file
ending in <code translate="no" dir="ltr">_gpu.cu.cc</code>, and some code shared in common in a <code translate="no" dir="ltr">.h</code> file.</p>

<p>For example, the <a href="https://www.tensorflow.org/api_docs/python/tf/pad"><code translate="no" dir="ltr">tf.pad</code></a> has
everything but the GPU kernel in <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/pad_op.cc"><code translate="no" dir="ltr">tensorflow/core/kernels/pad_op.cc</code></a>.
The GPU kernel is in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/pad_op_gpu.cu.cc"><code translate="no" dir="ltr">tensorflow/core/kernels/pad_op_gpu.cu.cc</code></a>,
and the shared code is a templated class defined in
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/kernels/pad_op.h"><code translate="no" dir="ltr">tensorflow/core/kernels/pad_op.h</code></a>.
We organize the code this way for two reasons: it allows you to share common
code among the CPU and GPU implementations, and it puts the GPU implementation
into a separate file so that it can be compiled only by the GPU compiler.</p>

<p>One thing to note, even when the GPU kernel version of <code translate="no" dir="ltr">pad</code> is used, it still
needs its <code translate="no" dir="ltr">&quot;paddings&quot;</code> input in CPU memory.  To mark that inputs or outputs are
kept on the CPU, add a <code translate="no" dir="ltr">HostMemory()</code> call to the kernel registration, e.g.:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-cp">#define REGISTER_GPU_KERNEL(T)                         \</span>
<span class="devsite-syntax-cp">  REGISTER_KERNEL_BUILDER(Name(&#34;Pad&#34;)                  \</span>
<span class="devsite-syntax-cp">                              .Device(DEVICE_GPU)      \</span>
<span class="devsite-syntax-cp">                              .TypeConstraint&lt;T&gt;(&#34;T&#34;)  \</span>
<span class="devsite-syntax-cp">                              .HostMemory(&#34;paddings&#34;), \</span>
<span class="devsite-syntax-cp">                          PadOp&lt;GPUDevice, T&gt;)</span>
</code></pre></devsite-code>
<h4 id="compiling_the_kernel_for_the_gpu_device" data-text="Compiling the kernel for the GPU device" tabindex="-1">Compiling the kernel for the GPU device</h4>

<p>Look at
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/adding_an_op/cuda_op_kernel.cu.cc">cuda_op_kernel.cu.cc</a>
for an example that uses a CUDA kernel to implement an op. The
<code translate="no" dir="ltr">tf_custom_op_library</code> accepts a <code translate="no" dir="ltr">gpu_srcs</code> argument in which the list of source
files containing the CUDA kernels (<code translate="no" dir="ltr">*.cu.cc</code> files) can be specified. For use
with a binary installation of TensorFlow, the CUDA kernels have to be compiled
with NVIDIA&#39;s <code translate="no" dir="ltr">nvcc</code> compiler. Here is the sequence of commands you can use to
compile the
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/adding_an_op/cuda_op_kernel.cu.cc">cuda_op_kernel.cu.cc</a>
and
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/examples/adding_an_op/cuda_op_kernel.cc">cuda_op_kernel.cc</a>
into a single dynamically loadable library:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Bash"><code translate="no" dir="ltr">nvcc<span class="devsite-syntax-w"> </span>-std<span class="devsite-syntax-o">=</span>c++14<span class="devsite-syntax-w"> </span>-c<span class="devsite-syntax-w"> </span>-o<span class="devsite-syntax-w"> </span>cuda_op_kernel.cu.o<span class="devsite-syntax-w"> </span>cuda_op_kernel.cu.cc<span class="devsite-syntax-w"> </span><span class="devsite-syntax-se">\</span>
<span class="devsite-syntax-w">  </span><span class="devsite-syntax-si">${</span><span class="devsite-syntax-nv">TF_CFLAGS</span><span class="devsite-syntax-p">[@]</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-w"> </span>-D<span class="devsite-syntax-w"> </span><span class="devsite-syntax-nv">GOOGLE_CUDA</span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-m">1</span><span class="devsite-syntax-w"> </span>-x<span class="devsite-syntax-w"> </span>cu<span class="devsite-syntax-w"> </span>-Xcompiler<span class="devsite-syntax-w"> </span>-fPIC

g++<span class="devsite-syntax-w"> </span>-std<span class="devsite-syntax-o">=</span>c++14<span class="devsite-syntax-w"> </span>-shared<span class="devsite-syntax-w"> </span>-o<span class="devsite-syntax-w"> </span>cuda_op_kernel.so<span class="devsite-syntax-w"> </span>cuda_op_kernel.cc<span class="devsite-syntax-w"> </span><span class="devsite-syntax-se">\</span>
<span class="devsite-syntax-w">  </span>cuda_op_kernel.cu.o<span class="devsite-syntax-w"> </span><span class="devsite-syntax-si">${</span><span class="devsite-syntax-nv">TF_CFLAGS</span><span class="devsite-syntax-p">[@]</span><span class="devsite-syntax-si">}</span><span class="devsite-syntax-w"> </span>-fPIC<span class="devsite-syntax-w"> </span>-lcudart<span class="devsite-syntax-w"> </span><span class="devsite-syntax-si">${</span><span class="devsite-syntax-nv">TF_LFLAGS</span><span class="devsite-syntax-p">[@]</span><span class="devsite-syntax-si">}</span>
</code></pre></devsite-code>
<p><code translate="no" dir="ltr">cuda_op_kernel.so</code> produced above can be loaded as usual in Python, using the
<a href="https://www.tensorflow.org/api_docs/python/tf/load_op_library"><code translate="no" dir="ltr">tf.load_op_library</code></a> function.</p>

<p>Note that if your CUDA libraries are not installed in <code translate="no" dir="ltr">/usr/local/lib64</code>,
you&#39;ll need to specify the path explicitly in the second (g++) command above.
For example, add <code translate="no" dir="ltr">-L /usr/local/cuda-8.0/lib64/</code> if your CUDA is installed in
<code translate="no" dir="ltr">/usr/local/cuda-8.0</code>.</p>
<aside class="note"><strong>Note:</strong><span> In some Linux settings, additional options to <code translate="no" dir="ltr">nvcc</code> compiling step are
needed. Add <code translate="no" dir="ltr">-D_MWAITXINTRIN_H_INCLUDED</code> to the <code translate="no" dir="ltr">nvcc</code> command line to avoid
errors from <code translate="no" dir="ltr">mwaitxintrin.h</code>.</span></aside>
<h3 id="implement_the_gradient_in_python" data-text="Implement the gradient in Python" tabindex="-1">Implement the gradient in Python</h3>

<p>Given a graph of ops, TensorFlow uses automatic differentiation
(backpropagation) to add new ops representing gradients with respect to the
existing ops.
To make automatic differentiation work for new ops, you must register a gradient
function which computes gradients with respect to the ops&#39; inputs given
gradients with respect to the ops&#39; outputs.</p>

<p>Mathematically, if an op computes \(y = f(x)\) the registered gradient op
converts gradients \(\partial L/ \partial y\) of loss \(L\) with respect to
\(y\) into gradients \(\partial L/ \partial x\) with respect to \(x\) via
the chain rule:</p>

<p>\[\frac{\partial L}{\partial x}
    = \frac{\partial L}{\partial y} \frac{\partial y}{\partial x}
    = \frac{\partial L}{\partial y} \frac{\partial f}{\partial x}.\]</p>

<p>In the case of <code translate="no" dir="ltr">ZeroOut</code>, only one entry in the input affects the output, so the
gradient with respect to the input is a sparse &quot;one hot&quot; tensor.  This is
expressed as follows:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="Python"><code translate="no" dir="ltr"><span class="devsite-syntax-kn">from</span> <span class="devsite-syntax-nn">tensorflow.python.framework</span> <span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-n">ops</span>
<span class="devsite-syntax-kn">from</span> <span class="devsite-syntax-nn">tensorflow.python.ops</span> <span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-n">array_ops</span>
<span class="devsite-syntax-kn">from</span> <span class="devsite-syntax-nn">tensorflow.python.ops</span> <span class="devsite-syntax-kn">import</span> <span class="devsite-syntax-n">sparse_ops</span>

<span class="devsite-syntax-nd">@ops</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">RegisterGradient</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-k">def</span> <span class="devsite-syntax-nf">_zero_out_grad</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">op</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">grad</span><span class="devsite-syntax-p">):</span>
  &#34;&#34;&#34;<span class="devsite-syntax-n">The</span> <span class="devsite-syntax-n">gradients</span> <span class="devsite-syntax-k">for</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>

  <span class="devsite-syntax-n">Args</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">op</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">The</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-err">`</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">Operation</span><span class="devsite-syntax-err">`</span> <span class="devsite-syntax-n">that</span> <span class="devsite-syntax-n">we</span> <span class="devsite-syntax-n">are</span> <span class="devsite-syntax-n">differentiating</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">which</span> <span class="devsite-syntax-n">we</span> <span class="devsite-syntax-n">can</span> <span class="devsite-syntax-n">use</span>
      <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">find</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">inputs</span> <span class="devsite-syntax-ow">and</span> <span class="devsite-syntax-n">outputs</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">original</span> <span class="devsite-syntax-n">op</span><span class="devsite-syntax-o">.</span>
    <span class="devsite-syntax-n">grad</span><span class="devsite-syntax-p">:</span> <span class="devsite-syntax-n">Gradient</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">respect</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-n">output</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-err">`</span> <span class="devsite-syntax-n">op</span><span class="devsite-syntax-o">.</span>

  <span class="devsite-syntax-n">Returns</span><span class="devsite-syntax-p">:</span>
    <span class="devsite-syntax-n">Gradients</span> <span class="devsite-syntax-k">with</span> <span class="devsite-syntax-n">respect</span> <span class="devsite-syntax-n">to</span> <span class="devsite-syntax-n">the</span> <span class="devsite-syntax-nb">input</span> <span class="devsite-syntax-n">of</span> <span class="devsite-syntax-err">`</span><span class="devsite-syntax-n">zero_out</span><span class="devsite-syntax-err">`</span><span class="devsite-syntax-o">.</span>
  &#34;&#34;&#34;
  <span class="devsite-syntax-n">to_zero</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">op</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">inputs</span><span class="devsite-syntax-p">[</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">]</span>
  <span class="devsite-syntax-n">shape</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">array_ops</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-n">index</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">array_ops</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">zeros_like</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-n">first_grad</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">array_ops</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">reshape</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">grad</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-o">-</span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">])[</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">]</span>
  <span class="devsite-syntax-n">to_zero_grad</span> <span class="devsite-syntax-o">=</span> <span class="devsite-syntax-n">sparse_ops</span><span class="devsite-syntax-o">.</span><span class="devsite-syntax-n">sparse_to_dense</span><span class="devsite-syntax-p">([</span><span class="devsite-syntax-n">index</span><span class="devsite-syntax-p">],</span> <span class="devsite-syntax-n">shape</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-n">first_grad</span><span class="devsite-syntax-p">,</span> <span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">)</span>
  <span class="devsite-syntax-k">return</span> <span class="devsite-syntax-p">[</span><span class="devsite-syntax-n">to_zero_grad</span><span class="devsite-syntax-p">]</span>  <span class="devsite-syntax-c1"># List of one Tensor, since we have one input</span>
</code></pre></devsite-code>
<p>Details about registering gradient functions with
<a href="https://www.tensorflow.org/api_docs/python/tf/RegisterGradient"><code translate="no" dir="ltr">tf.RegisterGradient</code></a>:</p>

<ul>
<li><p>For an op with one output, the gradient function will take an <a href="https://www.tensorflow.org/api_docs/python/tf/Operation"><code translate="no" dir="ltr">tf.Operation</code></a>,
<code translate="no" dir="ltr">op</code>, and a <a href="https://www.tensorflow.org/api_docs/python/tf/Tensor"><code translate="no" dir="ltr">tf.Tensor</code></a> <code translate="no" dir="ltr">grad</code> and build new ops out of the tensors
<code translate="no" dir="ltr">op.inputs[i]</code>, <code translate="no" dir="ltr">op.outputs[i]</code>, and <code translate="no" dir="ltr">grad</code>. Information about any attrs can
be found via <a href="https://www.tensorflow.org/api_docs/python/tf/Operation#get_attr"><code translate="no" dir="ltr">tf.Operation.get_attr</code></a>.</p></li>
<li><p>If the op has multiple outputs, the gradient function will take <code translate="no" dir="ltr">op</code> and
<code translate="no" dir="ltr">grads</code>, where <code translate="no" dir="ltr">grads</code> is a list of gradients with respect to each output.
The result of the gradient function must be a list of <code translate="no" dir="ltr">Tensor</code> objects
representing the gradients with respect to each input.</p></li>
<li><p>If there is no well-defined gradient for some input, such as for integer
inputs used as indices, the corresponding returned gradient should be
<code translate="no" dir="ltr">None</code>.  For example, for an op taking a floating point tensor <code translate="no" dir="ltr">x</code> and an
integer index <code translate="no" dir="ltr">i</code>, the gradient function would <code translate="no" dir="ltr">return [x_grad, None]</code>.</p></li>
<li><p>If there is no meaningful gradient for the op at all, you often will not have
to register any gradient, and as long as the op&#39;s gradient is never needed,
you will be fine. In some cases, an op has no well-defined gradient but can
be involved in the computation of the gradient. Here you can use
<code translate="no" dir="ltr">ops.NotDifferentiable</code> to automatically propagate zeros backwards.</p></li>
</ul>

<p>Note that at the time the gradient function is called, only the data flow graph
of ops is available, not the tensor data itself.  Thus, all computation must be
performed using other tensorflow ops, to be run at graph execution time.</p>

<p>Add type hints when registering the custom gradient for an op type to make the
code more readable, debuggable, easier to maintain, and more robust through data
validation. For example, when taking an <code translate="no" dir="ltr">op</code> as a parameter in a function,
specify that the gradient function will take an
<a href="https://www.tensorflow.org/api_docs/python/tf/Operation"><code translate="no" dir="ltr">tf.Operation</code></a>
as its parameter type.</p>

<h3 id="shape_functions_in_c" data-text="Shape functions in C++" tabindex="-1">Shape functions in C++</h3>

<p>The TensorFlow API has a feature called &quot;shape inference&quot; that provides
information about the shapes of tensors without having to execute the
graph. Shape inference is supported by &quot;shape functions&quot; that are registered for
each op type in the C++ <code translate="no" dir="ltr">REGISTER_OP</code> declaration, and perform two roles:
asserting that the shapes of the inputs are compatible during graph
construction, and specifying the shapes for the outputs.</p>

<p>Shape functions are defined as operations on the
<code translate="no" dir="ltr">shape_inference::InferenceContext</code> class. For example, in the shape function
for ZeroOut:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">([](</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InferenceContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">set_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Status</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">OK</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">});</span>
</code></pre></devsite-code>
<p><code translate="no" dir="ltr">c-&gt;set_output(0, c-&gt;input(0));</code> declares that the first output&#39;s shape should
be set to the first input&#39;s shape. If the output is selected by its index as in the above example, the second parameter of <code translate="no" dir="ltr">set_output</code> should be a <code translate="no" dir="ltr">ShapeHandle</code> object. You can create an empty <code translate="no" dir="ltr">ShapeHandle</code> object by its default constructor. The <code translate="no" dir="ltr">ShapeHandle</code> object for an input with index <code translate="no" dir="ltr">idx</code> can be obtained by <code translate="no" dir="ltr">c-&gt;input(idx)</code>.</p>

<p>There are a number of common shape functions
that apply to many ops, such as <code translate="no" dir="ltr">shape_inference::UnchangedShape</code> which can be
found in <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/common_shape_fns.h">common_shape_fns.h</a> and used as follows:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-n">REGISTER_OP</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">ZeroOut</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Input</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">to_zero</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">Output</span><span class="devsite-syntax-p">(</span>&#34;<span class="devsite-syntax-n">zeroed</span><span class="devsite-syntax-o">:</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">int32</span>&#34;<span class="devsite-syntax-p">)</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">UnchangedShape</span><span class="devsite-syntax-p">);</span>
</code></pre></devsite-code>
<p>A shape function can also constrain the shape of an input. For the version of
<a href="#conditional_checks_and_validation"><code translate="no" dir="ltr">ZeroOut</code> with a vector shape constraint</a>, the shape function
would be as follows:</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">([](</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InferenceContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">ShapeHandle</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">TF_RETURN_IF_ERROR</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">WithRank</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">),</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">1</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span>&amp;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">set_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Status</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">OK</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">});</span>
</code></pre></devsite-code>
<p>The <code translate="no" dir="ltr">WithRank</code> call validates that the input shape <code translate="no" dir="ltr">c-&gt;input(0)</code> has
a shape with exactly one dimension (or if the input shape is unknown,
the output shape will be a vector with one unknown dimension).</p>

<p>If your op is <a href="#polymorphism">polymorphic with multiple inputs</a>, you can use
members of <code translate="no" dir="ltr">InferenceContext</code> to determine the number of shapes to check, and
<code translate="no" dir="ltr">Merge</code> to validate that the shapes are all compatible (alternatively, access
attributes that indicate the lengths, with <code translate="no" dir="ltr">InferenceContext::GetAttr</code>, which
provides access to the attributes of the op).</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">([](</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InferenceContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">ShapeHandle</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">ShapeHandle</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-p">;</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">for</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-kt">size_t</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">=</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">;</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-w"> &lt; </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-&gt;</span><span class="devsite-syntax-n">num_inputs</span><span class="devsite-syntax-p">();</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-o">++</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">TF_RETURN_IF_ERROR</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">WithRank</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">i</span><span class="devsite-syntax-p">),</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">2</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span>&amp;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">        </span><span class="devsite-syntax-n">TF_RETURN_IF_ERROR</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">Merge</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span>&amp;<span class="devsite-syntax-n">output</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-p">}</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">set_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">output</span><span class="devsite-syntax-p">);</span>
<span class="devsite-syntax-w">      </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Status</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">OK</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-p">});</span>
</code></pre></devsite-code>
<p>Since shape inference is an optional feature, and the shapes of tensors may vary
dynamically, shape functions must be robust to incomplete shape information for
any of the inputs. The <code translate="no" dir="ltr">Merge</code> method in <a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/framework/shape_inference.h"><code translate="no" dir="ltr">InferenceContext</code></a>
allows the caller to assert that two shapes are the same, even if either
or both of them do not have complete information. Shape functions are defined
for all of the core TensorFlow ops and provide many different usage examples.</p>

<p>The <code translate="no" dir="ltr">InferenceContext</code> class has a number of functions that can be used to
define shape function manipulations.  For example, you can validate that a
particular dimension has a very specific value using <code translate="no" dir="ltr">InferenceContext::Dim</code> and
<code translate="no" dir="ltr">InferenceContext::WithValue</code>; you can specify that an output dimension is the
sum / product of two input dimensions using <code translate="no" dir="ltr">InferenceContext::Add</code> and
<code translate="no" dir="ltr">InferenceContext::Multiply</code>. See the <code translate="no" dir="ltr">InferenceContext</code> class for
all of the various shape manipulations you can specify. The following example sets
shape of the first output to (n, 3), where first input has shape (n, ...)</p>
<div></div><devsite-code><pre class="devsite-click-to-copy" translate="no" dir="ltr" is-upgraded syntax="C++"><code translate="no" dir="ltr"><span class="devsite-syntax-p">.</span><span class="devsite-syntax-n">SetShapeFn</span><span class="devsite-syntax-p">([](</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">tensorflow</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">shape_inference</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">InferenceContext</span><span class="devsite-syntax-o">*</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-p">)</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-p">{</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">set_output</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">,</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">Matrix</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">Dim</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-n">c</span><span class="devsite-syntax-o">-</span>&gt;<span class="devsite-syntax-n">input</span><span class="devsite-syntax-p">(</span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">),</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">0</span><span class="devsite-syntax-p">),</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-mi">3</span><span class="devsite-syntax-p">));</span>
<span class="devsite-syntax-w">    </span><span class="devsite-syntax-k">return</span><span class="devsite-syntax-w"> </span><span class="devsite-syntax-n">Status</span><span class="devsite-syntax-o">::</span><span class="devsite-syntax-n">OK</span><span class="devsite-syntax-p">();</span>
<span class="devsite-syntax-p">});</span>
</code></pre></devsite-code>
<p>If you have a complicated shape function, you should consider adding a test for
validating that various input shape combinations produce the expected output
shape combinations.  You can see examples of how to write these tests in some
our
<a href="https://github.com/tensorflow/tensorflow/blob/master/tensorflow/core/ops/array_ops_test.cc">core ops tests</a>.
(The syntax of <code translate="no" dir="ltr">INFER_OK</code> and <code translate="no" dir="ltr">INFER_ERROR</code> are a little cryptic, but try to be
compact in representing input and output shape specifications in tests.  For
now, see the surrounding comments in those tests to get a sense of the shape
string specification).</p>

<h2 id="build_a_pip_package_for_your_custom_op" data-text="Build a pip package for your custom op" tabindex="-1">Build a pip package for your custom op</h2>

<p>To build a <code translate="no" dir="ltr">pip</code> package for your op, see the
<a href="https://github.com/tensorflow/custom-op">tensorflow/custom-op</a> example. This
guide shows how to build custom ops from the TensorFlow pip package instead
of building TensorFlow from source.</p>

  

  
</div>

  

  
    
    
      
    <devsite-thumb-rating position="footer">
    </devsite-thumb-rating>
  
       
    
    
  

  
  
</article>


<devsite-content-footer class="nocontent">
  <p>Except as otherwise noted, the content of this page is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 License</a>, and code samples are licensed under the <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>. For details, see the <a href="https://developers.google.com/site-policies">Google Developers Site Policies</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
  <p>Last updated 2024-01-31 UTC.</p>
</devsite-content-footer>


<devsite-notification
>
</devsite-notification>


  
<div class="devsite-content-data">
  <template class="devsite-thumb-rating-down-categories">
  [{
      "type": "thumb-down",
      "id": "missingTheInformationINeed",
      "label":"Missing the information I need"
    },{
      "type": "thumb-down",
      "id": "tooComplicatedTooManySteps",
      "label":"Too complicated / too many steps"
    },{
      "type": "thumb-down",
      "id": "outOfDate",
      "label":"Out of date"
    },{
      "type": "thumb-down",
      "id": "samplesCodeIssue",
      "label":"Samples / code issue"
    },{
      "type": "thumb-down",
      "id": "otherDown",
      "label":"Other"
    }]
  </template>
  <template class="devsite-thumb-rating-up-categories">
  [{
      "type": "thumb-up",
      "id": "easyToUnderstand",
      "label":"Easy to understand"
    },{
      "type": "thumb-up",
      "id": "solvedMyProblem",
      "label":"Solved my problem"
    },{
      "type": "thumb-up",
      "id": "otherUp",
      "label":"Other"
    }]
  </template>
  
  
    <template class="devsite-lifecycle-data">
      {"lastModified": "Last updated 2024-01-31 UTC."}
    </template>
  
</div>
            
          </devsite-content>
        </main>
        <devsite-footer-promos class="devsite-footer">
          
            
          
        </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
          
            
<nav class="devsite-footer-linkboxes nocontent" aria-label="Footer links">
  
  <ul class="devsite-footer-linkboxes-list">
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Stay connected</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//blog.tensorflow.org"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Blog
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//discuss.tensorflow.org"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Forum
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//github.com/tensorflow/"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            GitHub
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//twitter.com/tensorflow"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Twitter
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//youtube.com/tensorflow"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            YouTube
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
    <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading no-link">Support</h3>
      <ul class="devsite-footer-linkbox-list">
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//github.com/tensorflow/tensorflow/issues"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 1)"
            >
            
          
            Issue tracker
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//github.com/tensorflow/tensorflow/blob/master/RELEASE.md"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 2)"
            >
            
          
            Release notes
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="//stackoverflow.com/questions/tagged/tensorflow"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 3)"
            >
            
          
            Stack Overflow
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/extras/tensorflow_brand_guidelines.pdf"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 4)"
            >
            
          
            Brand guidelines
          
          </a>
          
          
        </li>
        
        <li class="devsite-footer-linkbox-item">
          
          <a href="/about/bib"
             class="devsite-footer-linkbox-link gc-analytics-event"
             data-category="Site-Wide Custom Events"
            
             data-label="Footer Link (index 5)"
            >
            
              
              
            
          
            Cite TensorFlow
          
          </a>
          
          
        </li>
        
      </ul>
    </li>
    
  </ul>
  
</nav>
          
        </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
          
            

<div class="devsite-footer-utility nocontent">
  

  
  <nav class="devsite-footer-utility-links" aria-label="Utility links">
    
    <ul class="devsite-footer-utility-list">
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//policies.google.com/terms"
           data-category="Site-Wide Custom Events"
           data-label="Footer Terms link"
         >
          Terms
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 ">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//policies.google.com/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link"
         >
          Privacy
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 glue-cookie-notification-bar-control">
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="#"
           data-category="Site-Wide Custom Events"
           data-label="Footer Manage cookies link"
         
           aria-hidden="true"
         >
          Manage cookies
        </a>
        
      </li>
      
      <li class="devsite-footer-utility-item
                 devsite-footer-utility-button">
        
        <span class="devsite-footer-utility-description">Sign up for the TensorFlow newsletter</span>
        
        
        <a class="devsite-footer-utility-link gc-analytics-event"
           href="//www.tensorflow.org/subscribe"
           data-category="Site-Wide Custom Events"
           data-label="Footer Subscribe link"
         >
          Subscribe
        </a>
        
      </li>
      
    </ul>
    
    
<devsite-language-selector>
  <ul role="presentation">
    
    
    <li role="presentation">
      <a role="menuitem" lang="en"
        >English</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es"
        >Español</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="es_419"
        >Español – América Latina</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fr"
        >Français</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="id"
        >Indonesia</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="it"
        >Italiano</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pl"
        >Polski</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt"
        >Português</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="pt_br"
        >Português – Brasil</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="vi"
        >Tiếng Việt</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="tr"
        >Türkçe</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ru"
        >Русский</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="he"
        >עברית</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ar"
        >العربيّة</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="fa"
        >فارسی</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="hi"
        >हिंदी</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="bn"
        >বাংলা</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="th"
        >ภาษาไทย</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="zh_cn"
        >中文 – 简体</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ja"
        >日本語</a>
    </li>
    
    <li role="presentation">
      <a role="menuitem" lang="ko"
        >한국어</a>
    </li>
    
  </ul>
</devsite-language-selector>

  </nav>
</div>
          
        </devsite-footer-utility>
        <devsite-panel></devsite-panel>
        
      </section></section>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar
    
        type="cookie-notification"
        data-cookie-notice="4"
    
    >
</devsite-snackbar>
    <devsite-tooltip ></devsite-tooltip>
    <devsite-heading-link></devsite-heading-link>
    <devsite-analytics>
      
        <script type="application/json" analytics>[{&#34;dimensions&#34;: {&#34;dimension12&#34;: false, &#34;dimension6&#34;: &#34;en&#34;, &#34;dimension4&#34;: &#34;TensorFlow Core&#34;, &#34;dimension1&#34;: &#34;Signed out&#34;, &#34;dimension3&#34;: false, &#34;dimension5&#34;: &#34;de&#34;}, &#34;gaid&#34;: &#34;UA-69864048-1&#34;, &#34;metrics&#34;: {&#34;ratings_count&#34;: &#34;metric2&#34;, &#34;ratings_value&#34;: &#34;metric1&#34;}, &#34;purpose&#34;: 0}]</script>
<script type="application/json" tag-management>{&#34;at&#34;: &#34;True&#34;, &#34;ga4&#34;: [], &#34;ga4p&#34;: [], &#34;gtm&#34;: [{&#34;id&#34;: &#34;GTM-MXSL34P&#34;, &#34;purpose&#34;: 0}], &#34;parameters&#34;: {&#34;internalUser&#34;: &#34;False&#34;, &#34;language&#34;: {&#34;machineTranslated&#34;: &#34;False&#34;, &#34;requested&#34;: &#34;de&#34;, &#34;served&#34;: &#34;en&#34;}, &#34;pageType&#34;: &#34;article&#34;, &#34;projectName&#34;: &#34;TensorFlow Core&#34;, &#34;signedIn&#34;: &#34;False&#34;, &#34;tenant&#34;: &#34;tensorflow&#34;, &#34;recommendations&#34;: {&#34;sourcePage&#34;: &#34;&#34;, &#34;sourceType&#34;: 0, &#34;sourceRank&#34;: 0, &#34;sourceIdenticalDescriptions&#34;: 0, &#34;sourceTitleWords&#34;: 0, &#34;sourceDescriptionWords&#34;: 0, &#34;experiment&#34;: &#34;&#34;}, &#34;experiment&#34;: {&#34;ids&#34;: &#34;&#34;}}}</script>
      
    </devsite-analytics>
    
      <devsite-badger></devsite-badger>
    
    
    <script nonce="jansVn7OxdTU7t/iVP8MxX843gO+Ku">
  
  (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/js/app_loader.js', '[15,"de",null,"/js/devsite_app_module.js","https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144","https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow","https://tensorflow-dot-devsite-v2-prod-3p.appspot.com",null,null,["/_pwa/tensorflow/manifest.json","https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/images/favicon.png","https://www.gstatic.com/devrel-devsite/prod/v8330b7bdce12528ca95041e234ad065d24b70aaf6096876dac7cb56d8918f144/tensorflow/images/lockup.svg","https://fonts.googleapis.com/css?family=Google+Sans:400,500|Roboto:400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700&display=swap"],1,null,[1,6,8,12,14,17,21,25,50,52,63,70,75,76,80,87,91,92,93,97,98,100,101,102,103,104,105,107,108,109,110,112,113,116,117,118,120,122,124,125,126,127,129,130,131,132,133,134,135,136,138,140,141,147,148,149,151,152,156,157,158,159,161,163,164,168,169,170,179,180,182,183,186,191,193,196],"AIzaSyCNm9YxQumEXwGJgTDjxoxXK6m1F-9720Q","AIzaSyCc76DZePGtoyUjqKrLdsMGk_ry7sljLbY","www.tensorflow.org","AIzaSyB9bqgQ2t11WJsOX8qNsCQ6U-w91mmqF-I","AIzaSyAdYnStPdzjcJJtQ0mvIaeaMKj7_t6J_Fg",null,null,null,["Search__enable_page_map","EngEduTelemetry__enable_engedu_telemetry","Concierge__enable_pushui","Search__enable_dynamic_content_confidential_banner","TpcFeatures__enable_required_headers","Profiles__enable_profile_collections","Cloud__enable_legacy_calculator_redirect","Profiles__enable_awarding_url","MiscFeatureFlags__emergency_css","Search__enable_suggestions_from_borg","SignIn__enable_refresh_access_tokens","Cloud__enable_free_trial_server_call","TpcFeatures__enable_mirror_tenant_redirects","Profiles__enable_release_notes_notifications","Profiles__enable_public_developer_profiles","Profiles__require_profile_eligibility_for_signin","MiscFeatureFlags__developers_footer_image","Profiles__enable_recognition_badges","MiscFeatureFlags__enable_view_transitions","Profiles__enable_dashboard_curated_recommendations","Cloud__enable_cloud_dlp_service","MiscFeatureFlags__developers_footer_dark_image","MiscFeatureFlags__enable_project_variables","Analytics__enable_all_tenant_analytics","Analytics__enable_cookie_bar","MiscFeatureFlags__enable_firebase_utm","Cloud__enable_cloudx_experiment_ids","Cloud__enable_cloud_facet_chat","CloudShell__cloud_code_overflow_menu","Profiles__enable_page_saving","BookNav__enable_tenant_cache_key","Cloud__enable_cloud_shell","CloudShell__cloud_shell_button","MiscFeatureFlags__enable_variable_operator","Profiles__enable_developer_profiles_callout","Cloud__enable_llm_concierge_chat","Search__enable_ai_eligibility_checks","Cloud__enable_cloud_shell_fte_user_flow","Experiments__reqs_query_experiments","MiscFeatureFlags__enable_explain_this_code","Cloud__enable_cloudx_ping"],null,null,"AIzaSyA58TaKli1DculwmAmbpzLVGuWc8eCQgQc","https://developerscontentserving-pa.googleapis.com","AIzaSyDWBU60w0P9hEkr29kkksYs8Z7gvZ8u_wc","https://developerscontentsearch-pa.googleapis.com",2,4,null,"https://developerprofiles-pa.googleapis.com",[15,"tensorflow","TensorFlow","www.tensorflow.org",null,"tensorflow-dot-devsite-v2-prod-3p.appspot.com",null,null,[null,1,null,null,null,null,null,null,null,null,null,[1],null,null,null,null,null,null,[1],[1,null,null,[1]],null,null,null,[1,null,1],[1,1,null,1,1]],null,[25,null,null,null,null,null,"/images/lockup.svg","/images/logo.png",null,null,null,1,1,null,null,null,null,null,null,null,null,1,null,null,null,null,[]],[],null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,[6,1],null,[[],[1,1]],[[["UA-69864048-1"],["UA-69864048-4"],null,null,["UA-69864048-5"],["GTM-MXSL34P"],null,null,[["UA-69864048-1",1]],null,[["UA-69864048-5",1]],[["GTM-MXSL34P",1]],1],[[4,3],[6,5],[5,4],[3,2],[1,1],[12,8]],[[2,2],[1,1]]],null,4]]')
  
</script>
    <devsite-a11y-announce></devsite-a11y-announce>
  </body>
</html>